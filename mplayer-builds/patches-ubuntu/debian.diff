Index: create_deb.sh
===================================================================
--- create_deb.sh	(revisión: 0)
+++ create_deb.sh	(revisión: 0)
@@ -0,0 +1,25 @@
+#!/bin/sh
+
+svn_revision=`LC_ALL=C svn info 2> /dev/null | grep Revision | cut -d' ' -f2`
+test $svn_revision || svn_revision=`grep revision .svn/entries 2>/dev/null | cut -d '"' -f2`
+test $svn_revision || svn_revision=`sed -n -e '/^dir$/{n;p;q;}' .svn/entries 2>/dev/null`
+test $svn_revision || svn_revision=UNKNOWN
+
+# New debian
+mv debian debian-upstream
+ln -sf debian-rvm debian
+
+# Add entry to changelog with svn revision
+cp debian/changelog-orig debian/changelog
+dch -v "2:1.0~rc2svn$svn_revision" "New version"
+
+# Build
+rm build-gui-stamp
+chmod 755 debian-rvm/rules
+fakeroot debian/rules binary
+
+# Clean
+dh_clean
+rm debian/changelog
+rm debian
+mv debian-upstream debian

Cambios de propiedades en create_deb.sh
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/control
===================================================================
--- debian-rvm/control	(revisión: 0)
+++ debian-rvm/control	(revisión: 0)
@@ -0,0 +1,51 @@
+Source: mplayer
+Section: graphics
+Priority: extra
+Maintainer: Ricardo Villalba <rvm@escomposlinux.org>
+Standards-Version: 3.7.2
+Build-Depends: debhelper (>= 5.0.37), dpatch, nvidia-180-libvdpau-dev | libartsc0-dev, libncurses5-dev, libesd0-dev, liblircclient-dev, libgtk2.0-dev, libvorbis-dev, libsdl1.2-dev, sharutils, libasound2-dev (>= 1.0.1), liblzo-dev, gawk, libjpeg62-dev, libaudiofile-dev, libsmbclient-dev, libxv-dev, libpng3-dev, libgif-dev, libcdparanoia0-dev, libxvidcore4-dev, libdv-dev, liblivemedia-dev (>= 2004.05.01), libfreetype6-dev, em8300-headers, libgl1-mesa-dev | libgl-dev, libdvdread-dev (>= 4.1.3), libdts-dev, libtheora-dev, libglu1-mesa-dev | libglu-dev, libfontconfig-dev, libxxf86dga-dev, libxinerama-dev, libxxf86vm-dev, libmp3lame-dev | liblame-dev, libxvmc-dev, libggi2-dev, ttf-bitstream-vera, libmpcdec-dev, libspeex-dev, libfribidi-dev, libfaac-dev (>=1.26), sed (>= 4.0), libaa1-dev, libcaca-dev, libx264-dev (>= 1:0.svn20081230), libpulse-dev, libmad0-dev, ladspa-sdk, libdbus-glib-1-dev, libaudio-dev, liblzo2-dev, libdvdnav-dev (>= 4.1.3), libopenal-dev, libjack-dev, libtwolame-dev, libsvga1-dev [i386 amd64], libenca-dev, docbook-xml, docbook-xsl, xsltproc, libxml2-utils
+XSBC-Original-Maintainer: Ubuntu MOTU Media Team <motumedia@tauware.de>
+
+Package: mplayer
+Architecture: any
+Pre-Depends: dpkg (>= 1.14.12ubuntu3)
+Depends: ${shlibs:Depends}, ttf-bitstream-vera, mplayer-skins, ttf-dejavu-core
+Suggests: w32codecs [i386], w64codecs [amd64], libdvdcss2, mplayer-doc, smplayer
+Conflicts: mplayer-nogui
+Replaces: mplayer-nogui
+Description: The Ultimate Movie Player For Linux
+ It plays most mpeg, avi and asf files, supported by many native and win32
+ DLL codecs. You can watch VCD, DVD and even DivX movies too. The other
+ big feature of mplayer is the wide range of supported output drivers. It
+ works with X11, Xv, DGA, OpenGL, SVGAlib, fbdev, but you can use SDL (and
+ this way all drivers of SDL) and some lowlevel card-specific drivers (for
+ Matrox/3dfx/SiS) too! Most of them supports software or hardware scaling,
+ so you can enjoy movies in fullscreen.
+ .
+ This version includes the Gtk GUI
+
+Package: mencoder
+Architecture: any
+Pre-Depends: dpkg (>= 1.14.12ubuntu3)
+Depends: ${shlibs:Depends}
+Suggests: w32codecs [i386], w64codecs [amd64], libdvdcss2, mplayer-doc
+Description: MPlayer's Movie Encoder
+ A simple movie encoder, designed to encode MPlayer-playable movies
+ (AVI/ASF/OGG/DVD/VCD/VOB/MPG/MOV/VIV/FLI/RM/NUV/NET) to other
+ MPlayer-playable formats. It can encode with various codecs, like DivX4 (1
+ or 2 passes), libavcodec, PCM/MP3/VBRMP3 audio. Also has stream copying and
+ video resizing abilities.
+
+Package: mplayer-doc
+Architecture: all
+Pre-Depends: dpkg (>= 1.14.12ubuntu3)
+Description: The Ultimate Movie Player For Linux (Documentation)
+ It plays most mpeg, avi and asf files, supported by many native and win32
+ DLL codecs. You can watch VCD, DVD and even DivX movies too. The other
+ big feature of mplayer is the wide range of supported output drivers. It
+ works with X11, Xv, DGA, OpenGL, SVGAlib, fbdev, but you can use SDL (and
+ this way all drivers of SDL) and some lowlevel card-specific drivers (for
+ Matrox/3dfx/SiS) too! Most of them supports software or hardware scaling,
+ so you can enjoy movies in fullscreen.
+ .
+ This package contains the documentation for mplayer/mencoder
Index: debian-rvm/compat
===================================================================
--- debian-rvm/compat	(revisión: 0)
+++ debian-rvm/compat	(revisión: 0)
@@ -0,0 +1 @@
+5
Index: debian-rvm/changelog-orig
===================================================================
--- debian-rvm/changelog-orig	(revisión: 0)
+++ debian-rvm/changelog-orig	(revisión: 0)
@@ -0,0 +1,507 @@
+mplayer (2:1.0~rc2-0ubuntu15) intrepid; urgency=low
+
+  * Modify etc/mplayer.desktop to make it validate with
+    desktop-file-validate (LP: #244720)
+
+ -- Nathan Handler <nathan.handler@gmail.com>  Wed, 03 Sep 2008 12:38:53 +0100
+
+mplayer (2:1.0~rc2-0ubuntu14) intrepid; urgency=low
+
+  * Rebuild for liblame -> libmp3lame transition and adjust build-deps
+    accordingly (LP: #262832)
+  * Disable IVTV vo and ao as this causes the package to fail to build 
+
+ -- Iain Lane <iain@orangesquash.org.uk>  Tue, 02 Sep 2008 08:12:10 +0100
+
+mplayer (2:1.0~rc2-0ubuntu13) hardy; urgency=low
+
+  * SECURITY UPDATE: arbitrary code execution via crafted RTSP stream.
+    (LP: #212601)
+    - stream/realrtsp/sdpplin.c: Properly check the stream ID. Patch from
+      upstream.
+    - References:
+      + CVE-2008-1558
+
+ -- William Grant <william@qeuni.net>  Sun, 06 Apr 2008 10:49:10 +1000
+
+mplayer (2:1.0~rc2-0ubuntu12) hardy; urgency=low
+
+  * Modify mplayer.desktop to support opening URIs with spaces (LP: #164709).
+
+ -- Matti Lindell <mlind@cs.joensuu.fi>  Tue, 25 Mar 2008 19:01:10 +0200
+
+mplayer (2:1.0~rc2-0ubuntu11) hardy; urgency=low
+
+  * Actually drop the runtime CPU detection configure flag from the
+    arch-global variable, which I apparently missed in bzr last time.
+
+ -- William Grant <william@qeuni.net>  Mon, 24 Mar 2008 21:29:34 +1100
+
+mplayer (2:1.0~rc2-0ubuntu10) hardy; urgency=low
+
+  * Only build-depend on libsvga1-dev on i386 and amd64; it doesn't exist
+    anywhere else.
+  * Only enable runtime CPU detection on i386, amd64 and powerpc. Fixes FTBFS
+    on [!i386 amd64 powerpc].
+
+ -- William Grant <william@qeuni.net>  Mon, 24 Mar 2008 20:32:46 +1100
+
+mplayer (2:1.0~rc2-0ubuntu9) hardy; urgency=low
+
+  [ Luke Yelavich ]
+  * etc/example.conf: Use pulseaudio by default, and fallback to alsa.
+
+  [ William Grant ]
+  * SECURITY UPDATE: buffer overruns in CDDB, MOV demuxer, FLAC header parser,
+    and URL parser. (LP: #191488)
+  * libmpdemux/demux_audio.c, libmpdemux/demux_mov.c, stream/stream_cddb.c,
+    stream/url.c: Patches from upstream.
+  * References:
+    - CVE-2008-0485
+    - CVE-2008-0486
+    - CVE-2008-0629
+    - CVE-2008-0630
+  * debian/rules: Unset CFLAGS, to make it build again.
+
+ -- William Grant <william@qeuni.net>  Mon, 24 Mar 2008 13:55:38 +1100
+
+mplayer (2:1.0~rc2-0ubuntu8) hardy; urgency=low
+
+  * Use DejaVu instead of Bitstream Vera for subtitles so they show
+    correct characters for many non-English languages (LP: #48497)
+
+ -- Jani Monoses <jani@ubuntu.com>  Wed, 06 Feb 2008 09:27:55 +0200
+
+mplayer (2:1.0~rc2-0ubuntu7) hardy; urgency=low
+
+  * Add debian/mime to install mime types in (g)mplayer.
+  * Rebuild against newer x264 (LP: 177082, 172683, 181389)
+
+ -- Mario Limonciello <superm1@ubuntu.com>  Wed, 23 Jan 2008 01:24:45 -0600
+
+mplayer (2:1.0~rc2-0ubuntu6) hardy; urgency=low
+
+  * debian/rules:
+    - Drop old get-orig-source to avoid confusion.
+  * debian/control:
+    - Build depend on newer faac for libmp4v2 transition. (LP: 181389)
+
+ -- Mario Limonciello <superm1@ubuntu.com>  Tue, 22 Jan 2008 13:41:16 -0600
+
+mplayer (2:1.0~rc2-0ubuntu5) hardy; urgency=low
+
+  * Rebuild against libgif-dev instead of linungif4-dev (LP: #174252)
+
+ -- Ilya Eremin <che_guevara_3@bk.ru>  Sat, 22 Dec 2007 01:32:53 +0000
+
+mplayer (2:1.0~rc2-0ubuntu4) hardy; urgency=low
+
+  [ Mario Limonciello ]
+  * Rebuild against newer x264. (LP: #173624, 174087)
+  * Build with enca support. (LP: #115519)
+  * Fix gnome_screensaver errors. (LP: #108785, 104660, 159909, 113818)
+
+  [ Luca Barbieri ]
+  * Add locking support to Pulse Audio to prevent deadlocks. (LP: #136850)
+
+  [ Phillip Belemezov ]
+  * Fix gnome screensaver on amd64 (LP: #104660, 159861)
+
+ -- Mario Limonciello <superm1@ubuntu.com>  Tue, 11 Dec 2007 02:13:54 -0600
+
+mplayer (2:1.0~rc2-0ubuntu3) hardy; urgency=low
+
+  * No source changes, rebuild against newer x264. (LP: #173624)
+
+ -- Brandon Holtsclaw <brandon@imbrandon.com>  Mon, 03 Dec 2007 05:25:41 -0600
+
+mplayer (2:1.0~rc2-0ubuntu2) hardy; urgency=low
+
+  * No source changes, rebuild against newer x264. (LP: #138854)
+
+ -- Mario Limonciello <superm1@ubuntu.com>  Tue, 20 Nov 2007 15:55:53 -0600
+
+mplayer (2:1.0~rc2-0ubuntu1) hardy; urgency=low
+
+  * New upstream version. 
+    - Packaging (LP: #150925)
+    - MP3 Distortion (LP: #85751)
+    - Aspect ratio fixes (LP: #103038, #153543)
+    - Samba support (LP: #85052)
+  * Move 01_default_config.dpatch into bzr.
+  * Drop dpatch from build-depends and debian/rules
+  * Add liblzo2-dev, libdvdnav-dev, libopenal-dev,
+    libjack-dev, libtwolame-dev, libsvga1-dev to build dependencies.
+  * debian/rules:
+    - Build with radio interface support
+    - Build with OpenAL, Jack audio support. (LP: #122042)
+    - Let Xvid support be autodetected for proper linking.
+    - Let Faac support be autodetected for proper linking.
+    - Let fontconfig support be autodetected for proper linking.
+    - Let LIVE555 support be autodetected for proper linking.
+    - Drop DOCS/zh from dh_installdocs
+    - Build with dvdnav support.
+    - Adjust changelog that gets installed.
+  * Add polish translation for .desktop file (LP: #93382)
+  * Adjust configure script to properly link dbus-glib and pulse audio.
+  * Disable joystick by default (LP: #75925)
+  * Adjust configure script to call dvdnav-config properly.
+
+ -- Mario Limonciello <superm1@ubuntu.com>  Sat, 03 Nov 2007 09:26:21 -0400
+
+mplayer (2:1.0~rc1-0ubuntu13) gutsy; urgency=low
+
+  * 01_default_config.dpatch: Fix typo that prevent the screensaver to be
+    disabled (LP: #152080)
+
+ -- Laurent Bigonville <bigon@ubuntu.com>  Sat, 13 Oct 2007 14:28:11 +0200
+
+mplayer (2:1.0~rc1-0ubuntu12) gutsy; urgency=low
+
+  * Add 01_default_config.dpatch.
+    - Sets screensaver by default for non gmplayer. 
+      (LP: #95038), (LP: #139770)
+    - Sets xv as video output for gmplayer and mplayer. 
+      (LP: #65165), (LP: #146307)
+  * Add dpatch to build-depends in debian/control.
+  * Add dpatch support to debian/rules.
+
+ -- Mario Limonciello <superm1@ubuntu.com>  Mon, 08 Oct 2007 01:07:53 -0500
+
+mplayer (2:1.0~rc1-0ubuntu11) gutsy; urgency=low
+
+  * Added Network Audio System (NAS) support  (LP: #110151)
+
+ -- Alfredo Matos <alfredo.matos@digitalself.org>  Thu, 07 Jun 2007 21:53:04 +0100
+
+mplayer (2:1.0~rc1-0ubuntu10) gutsy; urgency=low
+
+  * SECURITY UPDATE: Upstream fix for CVE 2007-2948. Fixes a buffer overrun in
+    the cddb code. (LP: #118855)
+
+ -- William Grant <william@qeuni.net>  Wed, 06 Jun 2007 17:22:22 +1000
+
+mplayer (2:1.0~rc1-0ubuntu9) feisty; urgency=low
+
+  * Rebuild to get correct version of libdirectfb
+  * Modified Maintainer value to match Debian-Maintainer-Field Spec
+
+ -- Sarah Hobbs <hobbsee@ubuntu.com>  Mon,  9 Apr 2007 21:55:23 +1000
+
+mplayer (2:1.0~rc1-0ubuntu8) feisty; urgency=low
+
+  * Fix some formatting in our patches.
+  * etc/examples.conf:
+    - Add ac=mad, to use libmad as first choice.
+  * debian/rules:
+    - Reenable mp3lib again... *sigh*
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Mon, 12 Mar 2007 03:42:49 +0100
+
+mplayer (2:1.0~rc1-0ubuntu7) feisty; urgency=low
+
+  [ Christian Bjälevik ]
+  * debian/rules:
+    - Add --disable-mp3lib to actually disable the damn thing.
+  * DOCS/man/en/mplayer.1:
+    - Remove documentation about -vo aa:help (LP: #43301).
+  * Various files (see bzr diff for info):
+    - Apply patch taken from Mandriva CVS (LP: #53947)
+      to use dbus for disabling gnome-screensaver.
+
+  [ William Grant ]
+  * Enable LADSPA (LP: #67400)
+    - Add ladspa-sdk to Build-Depends.
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Sun, 11 Mar 2007 05:43:02 +0100
+
+mplayer (2:1.0~rc1-0ubuntu6) feisty; urgency=low
+
+  * debian/rules:
+    - Disable mp3lib and enable mad (LP: #85751).
+  * debian/control:
+    - Add libmad0-dev to Build-Deps.
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Sat, 10 Mar 2007 11:05:40 +0100
+
+mplayer (2:1.0~rc1-0ubuntu5) feisty; urgency=low
+
+  * SECURITY UPDATE: DirectShow decoder heap overflow.
+  * loader/dshow/DS_VideoDecoder.c: added upstream fix.
+  * References
+    http://bugs.debian.org/cgi-bin/bugreport.cgi?bug=414072
+
+ -- Kees Cook <kees@ubuntu.com>  Fri,  9 Mar 2007 08:52:34 -0800
+
+mplayer (2:1.0~rc1-0ubuntu4) feisty; urgency=low
+
+  * SECURITY UPDATE: DMO decoder heap overflow.
+  * loader/dmo/DMO_VideoDecoder.c: added upstream fix.
+  * References
+    http://svn.mplayerhq.hu/mplayer/trunk/loader/dmo/DMO_VideoDecoder.c?r1=22019&r2=22204
+    CVE-2007-1246
+
+ -- Kees Cook <kees@ubuntu.com>  Tue,  6 Mar 2007 15:21:26 -0800
+
+mplayer (2:1.0~rc1-0ubuntu3) feisty; urgency=low
+
+  * debian/rules:
+    - Add --enable-mp3lib to CONFIGURE_AUDIO_CODECS (LP: #83580).
+    - Remove --disable-mp3lib. This one took some time to find.
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Tue,  6 Feb 2007 19:47:34 +0100
+
+mplayer (2:1.0~rc1-0ubuntu2) feisty; urgency=low
+
+  * debian/rules:
+    - Add --enable-libvorbis to CONFIGURE_AUDIO_CODECS.
+  * debian/{compat,control}:
+    - Bump Standard-Versions and debhelper >=.
+  * Applied patch from: http://0pointer.de/public/mplayer-pulse.patch
+    and adapted it for our current mplayer. Closes: #83493.
+  * debian/{control,rules}
+    - Add Build-Deps on libpulse-dev and --enable-pulse.
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Tue,  6 Feb 2007 07:19:34 +0100
+
+mplayer (2:1.0~rc1-0ubuntu1) feisty; urgency=low
+
+  * New upstream version.
+  * Apply RTSP buffer overflow fix patch from upstream.
+  * Remove --enable-{vorbis,x264} and s/internal-tremor/tremor-internal/ in
+    debian/rules. The defaults are detected properly, and forcing x264 now
+    causes it to FTBFS.
+  * Remove DOCS/it from dh_installdocs. Aforementioned directory no longer
+    exists.
+
+ -- William Grant <william.grant@ubuntu.org.au>  Sun,  4 Feb 2007 15:04:46 +1100
+
+mplayer (2:0.99+1.0pre8-0ubuntu8) edgy; urgency=low
+
+  * No-change rebuild against newer libx264-dev (affects
+    Ubuntu: #63842),
+    - RC freeze exception granted by Andrew Mitchell.
+
+ -- Daniel T Chen <crimsun@ubuntu.com>  Thu, 12 Oct 2006 17:07:36 -0400
+
+mplayer (2:0.99+1.0pre8-0ubuntu7) edgy; urgency=low
+
+  * libvo/osd_template.c:
+    - Add patch from Ubuntu #62209 to fix AMD64 FTBFS.
+      Thanks Andreas Schultz.
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Tue, 26 Sep 2006 15:15:27 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu6) edgy; urgency=low
+
+  * debian/preinst:
+    - Remove codecs.conf if it exists on the system
+      (thanks Johan Kiviniemi).
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Fri, 22 Sep 2006 20:45:08 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu5) edgy; urgency=low
+
+  * configure:
+    - Revert "if cygwin", we don't want to care changes like that.
+  * etc/example.conf:
+    - Revert vo and make "ao=alsa,". That means prefer alsa and
+      then auto-detect the rest.
+  * libmpcodecs/ve_lavc.c:
+    - Revert our changes. We build against internal ffmpeg again.
+  * debian/control:
+    - Dropped dpatch and libmad0-dev as Build-Deps.
+    - Drop all dummy packages and fix Conflicts/Replaces.
+    - Dropped the field Uploaders. Useless for Ubuntu.
+    - Dropped libavcodec-dev, libavformat-dev, libpostproc-dev
+      from Build-Deps.
+  * debian/rules:
+    - Stop copying config.{guess,sub}, this just add bloat to the
+      diff.
+    - Use --with-codecsdir instead of setting the same for win32,
+      xanim and real. Also drop --enable-{win32,real}, they are
+      implied by --with-codecsdir and enabled on all arches now.
+    - Drop defaults (--datadir and --disable-external-faad).
+    - Dropped libmad, the other two mp3-decoders should be enough.
+    - --enable-dshow was dropped upstream.
+    - Stop installing codecs.conf.
+    - Build against internal ffmpeg.
+
+ -- Christian Bjälevik <nafallo@ubuntu.com>  Thu, 21 Sep 2006 14:18:44 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu4) edgy; urgency=low
+
+  * debian/control,
+    debian/rules:
+    + Use the system's libavcodec, libavformat and libpostproc
+  * debian/rules:
+    + Add hack to enable more runtime-detected CPU optimizations on i386
+  * debian/control:
+    + Build-Depend on libx264-dev (>= 1:0.cvs20060720) to get a compatible
+      version
+  * debian/rules:
+    + disable internal mp3lib. This will enable mad or ffmpeg as
+      replacement (Ubuntu: #52729)
+  * libmpcodecs/ve_lavc.c:
+    + remove stuff that uses a newer libavcodec API than we have
+  * libmpcodecs/ve_x264.c:
+    + fix from upstream svn to build against our latest libx264
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Sun, 23 Jul 2006 13:33:53 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu3) edgy; urgency=low
+
+  * Remove a broken newline in debian/rules to really build with i586 as
+    target
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Sat,  8 Jul 2006 19:50:53 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu2) edgy; urgency=low
+
+  * Don't use --enable-vidix on powerpc. This parameter doesn't exist anymore
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Sat,  8 Jul 2006 19:28:42 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu1) edgy; urgency=low
+
+  * converted to bzr
+  * dropped dpatch, converted them all to bzr branches
+  * remerged all missing branches, except 57_demuxer_heap_overflow,
+    which has been merged upstream
+  * revert nsv-support patch, due to syntax error in codecs.conf
+
+ -- Reinhard Tartler <siretart@tauware.de>  Sat,  8 Jul 2006 15:05:34 +0200
+
+mplayer (2:0.99+1.0pre8-0ubuntu0) UNRELEASED; urgency=low
+
+  * unreleased testversion
+  * new upstream version
+    + far too many changes to list here
+  *  disabled dpatches temporarily:
+     -04_ubuntu-branding.dpatch
+     -57_demuxer_heap_overflow
+     -06_close_gracefully.dpatch
+
+ -- Reinhard Tartler <siretart@tauware.de>  Sat,  8 Jul 2006 12:03:40 +0200
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu8) dapper; urgency=low
+
+  * 07_hig-compliant-desktop-file.dpatch:
+    - Use a more HIG compliant name for mplayer in the .desktop file.
+      Thanks to Matthew East for the patch (Ubuntu: #38205)
+  * 08_nsv-support.dpatch:
+    - Add support for specific NSV files. Thanks to Dana Olson for the patch.
+      (Ubuntu: #44831)
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Mon, 15 May 2006 22:22:34 +0200
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu7) dapper; urgency=low
+
+  * debian/patches/06_close_gracefully.dpatch:
+    + Close gracefully when closing the mplayer window (Ubuntu: #38737)
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Wed, 10 May 2006 16:04:56 +0200
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu6) dapper; urgency=low
+
+  * add libx264-dev to builddeps and activate that in debian rules
+    Thanks to Yagisan (Closes: M#31519)
+  * disable external faad (Closes: M#33828)
+  * add some of the script which upstream distributs in TOOLS/ to
+    /usr/share/doc/mplayer/examples. Please report bugs if you want
+    additional scripts added there.
+
+ -- Reinhard Tartler <siretart@tauware.de>  Sat, 25 Mar 2006 19:14:02 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu5) dapper; urgency=low
+
+  * [SECURITY]: Fix heap overflow in libmpdemux/demuxer.h. Patch
+    retrieved from upstream CVS courtesy of Dennis Kaarsemaker.
+  * References
+    - CVE-2006-0579
+    - http://bugs.gentoo.org/show_bug.cgi?id=122029
+
+ -- Daniel T Chen <crimsun@ubuntu.com>  Sat, 25 Feb 2006 23:19:46 -0800
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu4) dapper; urgency=low
+
+  * added 05_gnome-screensaver-handling.dpatch to add support for
+    gnome-screensaver to the -stop-xscreensaver option 
+
+ -- Oliver Grawert <ogra@ubuntu.com>  Sat, 25 Feb 2006 20:52:36 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu3) dapper; urgency=low
+
+  * Add support for real codecs on powerpc (Closes Malone: #29190)
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Sat, 18 Feb 2006 11:05:18 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu2) dapper; urgency=low
+
+  * enable libaa and libcaca support
+    - enable in debian/rules
+    - fix configure to link mplayer with -laa (update 03_fix-linking.dpatch)
+
+ -- Reinhard Tartler <siretart@ubuntu.com>  Tue, 24 Jan 2006 01:31:46 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20060117-0ubuntu1) dapper; urgency=low
+
+  * New CVS snapshot
+  * Improved Ubuntu branding by using the version from the changelog instead
+    of the default "dev-CVS--Ubuntu-4.0.3"
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Tue, 17 Jan 2006 08:21:48 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu7) dapper; urgency=low
+
+  * Revert last change... I see no way how win32 support could ever work with
+    a 64bit binary on amd64 but when someone has a patch to enable it please
+    send it to me
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Fri,  9 Dec 2005 17:50:36 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu6) dapper; urgency=low
+
+  * Enable win32 support for amd64 (thanks fabbione) :)
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Thu,  8 Dec 2005 23:04:07 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu5) dapper; urgency=low
+
+  * Don't install the mencoder manpage in the mplayer package to prevent a
+    conflict
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Thu,  8 Dec 2005 19:35:18 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu4) dapper; urgency=low
+
+  * Don't install .libdeps in examples
+  * Install {input,codecs,menu}.conf to /etc/mplayer where we had them before
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Thu,  8 Dec 2005 19:15:39 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu3) dapper; urgency=low
+
+  * Stop having mplayer conflict with the mplayer-$arch transitional
+    packages, so the transition can actually happen correctly.
+
+ -- Adam Conrad <adconrad@ubuntu.com>  Thu,  8 Dec 2005 15:43:58 +1100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu2) dapper; urgency=low
+
+  * Add dummy packages for the mplayer-$arch packages we had before
+  * Patch away the CPU runtime detection warning
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Wed,  7 Dec 2005 15:39:24 +0100
+
+mplayer (2:0.99+1.0pre7try2+cvs20051205-0ubuntu1) dapper; urgency=low
+
+  * Initial release.
+  * Completly repackaged
+  * Based on ffmpeg/mplayer CVS 2005-12-05
+  * debian/patches/01_configure.dpatch: fixes live.com bulding.
+    the patch is taken from Marillat's mplayer package
+  * debian/patches/02_mplayer.conf.dpatch: use a better suited config for
+    ubuntu
+
+ -- Sebastian Dröge <slomo@ubuntu.com>  Wed, 05 Dec 2005 14:43:37 +0100
Index: debian-rvm/mplayer.examples
===================================================================
--- debian-rvm/mplayer.examples	(revisión: 0)
+++ debian-rvm/mplayer.examples	(revisión: 0)
@@ -0,0 +1 @@
+TOOLS/*
Index: debian-rvm/mime
===================================================================
--- debian-rvm/mime	(revisión: 0)
+++ debian-rvm/mime	(revisión: 0)
@@ -0,0 +1,20 @@
+application/x-ogg; mplayer %s; description="Ogg Stream"
+application/ogg; mplayer %s; description="Ogg Stream"
+audio/mpeg; mplayer %s; description="MPEG Audio"
+audio/x-mpegurl; mplayer %s; description="Icecast Playlist"
+audio/x-ms-wax; mplayer %s; description="Windows Media Audio"
+audio/x-ms-wma; mplayer %s; description="Windows Media Audio"
+audio/x-pls; mplayer %s; description="MP3 ShoutCast/IceCast Playlist"
+audio/x-scpls; mplayer %s; description="Shoutcast Playlist"
+audio/x-wav; mplayer %s; description="WAV Audio"
+video/mpeg; mplayer %s; description="MPEG Video";
+video/quicktime; mplayer %s; description="Apple QuickTime Video";
+video/x-mpeg; mplayer %s; description="MPEG Video";
+video/x-mpeg2; mplayer %s; description="MPEG-2 Video";
+video/x-msvideo; mplayer %s; description="MS Video (AVI)";
+video/x-ms-afs; mplayer %s; description="Microsoft ASF Video";
+video/x-ms-asf; mplayer %s; description="Microsoft ASF Video";
+video/x-ms-wma; mplayer %s; description="Windows Media Audio";
+video/x-ms-wmv; mplayer %s; description="Windows Media Video";
+video/x-ms-wmx; mplayer %s; description="Windows Media Video";
+video/x-ms-wvx; mplayer %s; description="Windows Media Video";
Index: debian-rvm/patches/05-ass_for_mencoder_embeddedfonts.dpatch
===================================================================
--- debian-rvm/patches/05-ass_for_mencoder_embeddedfonts.dpatch	(revisión: 0)
+++ debian-rvm/patches/05-ass_for_mencoder_embeddedfonts.dpatch	(revisión: 0)
@@ -0,0 +1,500 @@
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 05-ass_for_mencoder_embeddedfonts.dpatch by  <rvm@escomposlinux.org>
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: No description.
+
+@DPATCH@
+diff -urNad svn~/DOCS/man/en/mplayer.1 svn/DOCS/man/en/mplayer.1
+--- svn~/DOCS/man/en/mplayer.1	2008-11-07 16:10:14.000000000 +0100
++++ svn/DOCS/man/en/mplayer.1	2008-11-07 16:16:44.000000000 +0100
+@@ -7177,6 +7177,48 @@
+ Threshold below which a pixel value is considered black (default: 32).
+ .RE
+ .
++.TP
++.B fixpts[=options]
++Fixes the presentation timestamps (PTS) of the frames.
++By default, the PTS passed to the next filter is dropped, but the following
++options can change that:
++.RSs
++.IPs print
++Print the incoming PTS.
++.IPs fps=<fps>
++Specify a frame per second value.
++.IPs start=<pts>
++Specify an initial value for the PTS.
++.IPs autostart=<n>
++Uses the 
++.IR n th
++incoming PTS as the initial PTS.
++All previous pts are kept, so setting a huge value or \-1 keeps the PTS
++intact.
++.IPs autofps=<n>
++Uses the 
++.IR n th
++incoming PTS after the end of autostart to determine the framerate.
++.RE
++.sp 1
++.RS
++.I EXAMPLE:
++.RE
++.PD 0
++.RSs
++.IPs "\-vf fixpts=fps=24000/1001,ass,fixpts"
++Generates a new sequence of PTS, uses it for ASS subtitles, then drops it.
++Generating a new sequence is useful when the timestamps are reset during the
++program; this is frequent on DVDs.
++Dropping it may be necessary to avoid confusing encoders.
++.RE
++.PD 1
++.sp 1
++.RS
++.I NOTE:
++Using this filter together with any sort of seeking (including -ss and EDLs)
++may make demons fly out of your nose.
++.RE
+ .
+ .
+ .SH "GENERAL ENCODING OPTIONS (MENCODER ONLY)"
+@@ -7299,6 +7341,14 @@
+ Do not write OpenDML index for AVI files >1GB.
+ .
+ .TP
++.B \-keep\-pts
++Send the original presentation timestamp (PTS) down the filter and encoder
++chain.
++This may cause incorrect output ("badly interleaved") if the original PTS
++are wrong or the framerate is changed, but can be necessary for certain
++filters (such as ASS).
++.
++.TP
+ .B \-noskip
+ Do not skip frames.
+ .
+diff -urNad svn~/Makefile svn/Makefile
+--- svn~/Makefile	2008-11-01 11:26:10.000000000 +0100
++++ svn/Makefile	2008-11-07 16:16:44.000000000 +0100
+@@ -125,6 +125,7 @@
+               libmpcodecs/vf_field.c \
+               libmpcodecs/vf_fil.c \
+               libmpcodecs/vf_filmdint.c \
++              libmpcodecs/vf_fixpts.c \
+               libmpcodecs/vf_flip.c \
+               libmpcodecs/vf_format.c \
+               libmpcodecs/vf_framestep.c \
+diff -urNad svn~/cfg-mencoder.h svn/cfg-mencoder.h
+--- svn~/cfg-mencoder.h	2008-11-01 11:26:10.000000000 +0100
++++ svn/cfg-mencoder.h	2008-11-07 16:16:44.000000000 +0100
+@@ -213,6 +213,9 @@
+ 	
+ 	{"odml", &write_odml, CONF_TYPE_FLAG, CONF_GLOBAL, 0, 1, NULL},
+ 	{"noodml", &write_odml, CONF_TYPE_FLAG, CONF_GLOBAL, 1, 0, NULL},
++
++	{"keep-pts", &keep_pts, CONF_TYPE_FLAG, 0, 0, 1, NULL},
++	{"nokeep-pts", &keep_pts, CONF_TYPE_FLAG, 0, 1, 0, NULL},
+ 	
+ 	// info header strings
+ 	{"info", info_conf, CONF_TYPE_SUBCONFIG, CONF_GLOBAL, 0, 0, NULL},
+diff -urNad svn~/libass/ass_cache.c svn/libass/ass_cache.c
+--- svn~/libass/ass_cache.c	2008-11-01 11:26:10.000000000 +0100
++++ svn/libass/ass_cache.c	2008-11-07 16:16:44.000000000 +0100
+@@ -291,6 +291,39 @@
+ 	free(value);
+ }
+ 
++static int glyph_compare(void* key1, void* key2, size_t key_size) {
++	glyph_hash_key_t* a = key1;
++	glyph_hash_key_t* b = key2;
++	return
++		a->font == b->font &&
++		a->size == b->size &&
++		a->ch == b->ch &&
++		a->bold == b->bold &&
++		a->italic == b->italic &&
++		a->scale_x == b->scale_x &&
++		a->scale_y == b->scale_y &&
++		a->advance.x == b->advance.x &&
++		a->advance.y == b->advance.y &&
++		a->outline == b->outline;
++}
++
++static unsigned glyph_hash(void* buf, size_t len)
++{
++	glyph_hash_key_t* g = buf;
++	unsigned hval = FNV1_32A_INIT;
++	hval = fnv_32a_buf(&g->font, sizeof(g->font), hval);
++	hval = fnv_32a_buf(&g->size, sizeof(g->size), hval);
++	hval = fnv_32a_buf(&g->ch, sizeof(g->ch), hval);
++	hval = fnv_32a_buf(&g->bold, sizeof(g->bold), hval);
++	hval = fnv_32a_buf(&g->italic, sizeof(g->italic), hval);
++	hval = fnv_32a_buf(&g->scale_x, sizeof(g->scale_x), hval);
++	hval = fnv_32a_buf(&g->scale_y, sizeof(g->scale_y), hval);
++	hval = fnv_32a_buf(&g->advance.x, sizeof(g->advance.x), hval);
++	hval = fnv_32a_buf(&g->advance.y, sizeof(g->advance.y), hval);
++	hval = fnv_32a_buf(&g->outline, sizeof(g->outline), hval);
++	return hval;
++}
++
+ void* cache_add_glyph(glyph_hash_key_t* key, glyph_hash_val_t* val)
+ {
+ 	return hashmap_insert(glyph_cache, key, val);
+@@ -311,7 +344,9 @@
+ 	glyph_cache = hashmap_init(sizeof(glyph_hash_key_t),
+ 				   sizeof(glyph_hash_val_t),
+ 				   0xFFFF + 13,
+-				   glyph_hash_dtor, NULL, NULL);
++				   glyph_hash_dtor,
++				   glyph_compare,
++				   glyph_hash);
+ }
+ 
+ void ass_glyph_cache_done(void)
+diff -urNad svn~/libmpcodecs/vf.c svn/libmpcodecs/vf.c
+--- svn~/libmpcodecs/vf.c	2008-11-01 11:26:10.000000000 +0100
++++ svn/libmpcodecs/vf.c	2008-11-07 16:16:44.000000000 +0100
+@@ -99,6 +99,7 @@
+ extern const vf_info_t vf_info_blackframe;
+ extern const vf_info_t vf_info_geq;
+ extern const vf_info_t vf_info_ow;
++extern const vf_info_t vf_info_fixpts;
+ 
+ // list of available filters:
+ static const vf_info_t* const filter_list[]={
+@@ -191,6 +192,7 @@
+     &vf_info_yadif,
+     &vf_info_blackframe,
+     &vf_info_ow,
++    &vf_info_fixpts,
+     NULL
+ };
+ 
+diff -urNad svn~/libmpcodecs/vf_fixpts.c svn/libmpcodecs/vf_fixpts.c
+--- svn~/libmpcodecs/vf_fixpts.c	1970-01-01 01:00:00.000000000 +0100
++++ svn/libmpcodecs/vf_fixpts.c	2008-11-07 16:16:44.000000000 +0100
+@@ -0,0 +1,137 @@
++/*
++    Copyright (C) 2007 Nicolas George <nicolas.george@normalesup.org>
++
++    This program is free software; you can redistribute it and/or modify
++    it under the terms of the GNU General Public License as published by
++    the Free Software Foundation; either version 2 of the License, or
++    (at your option) any later version.
++
++    This program is distributed in the hope that it will be useful,
++    but WITHOUT ANY WARRANTY; without even the implied warranty of
++    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
++    GNU General Public License for more details.
++
++    You should have received a copy of the GNU General Public License
++    along with this program; if not, write to the Free Software
++    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
++*/
++
++#include <stdio.h>
++#include <stdlib.h>
++#include <string.h>
++#include <inttypes.h>
++
++#include "config.h"
++#include "mp_msg.h"
++#include "help_mp.h"
++
++#include "img_format.h"
++#include "mp_image.h"
++#include "vf.h"
++
++struct vf_priv_s {
++    double current;
++    double step;
++    int autostart;
++    int autostep;
++    unsigned have_step: 1;
++    unsigned print: 1;
++};
++
++static int put_image(vf_instance_t *vf, mp_image_t *src, double pts)
++{
++    struct vf_priv_s *p = vf->priv;
++
++    if(p->print) {
++	if(pts == MP_NOPTS_VALUE)
++	    printf("PTS: undef\n");
++	else
++	    printf("PTS: %f\n", pts);
++    }
++    if(pts != MP_NOPTS_VALUE && p->autostart != 0) {
++	p->current = pts;
++	if(p->autostart > 0)
++	    p->autostart--;
++    } else if(pts != MP_NOPTS_VALUE && p->autostep > 0) {
++	p->step = pts - p->current;
++	p->current = pts;
++	p->autostep--;
++	p->have_step = 1;
++    } else if(p->have_step) {
++	p->current += p->step;
++	pts = p->current;
++    } else {
++	pts = MP_NOPTS_VALUE;
++    }
++    return vf_next_put_image(vf, src, pts);
++}
++
++static void uninit(vf_instance_t *vf)
++{
++    free(vf->priv);
++}
++
++static int parse_args(struct vf_priv_s *p, const char *args)
++{
++    int pos;
++    double num, denom = 1;
++    int iarg;
++
++    while(*args != 0) {
++	pos = 0;
++	if(sscanf(args, "print%n", &pos) == 0 && pos > 0) {
++	    p->print = 1;
++	} else if(sscanf(args, "fps=%lf%n/%lf%n", &num, &pos, &denom, &pos) >= 1
++	    && pos > 0) {
++	    p->step = denom / num;
++	    p->have_step = 1;
++	} else if(sscanf(args, "start=%lf%n", &num, &pos) >= 1 && pos > 0) {
++	    p->current = num;
++	} else if(sscanf(args, "autostart=%d%n", &iarg, &pos) == 1 && pos > 0) {
++	    p->autostart = iarg;
++	} else if(sscanf(args, "autofps=%d%n", &iarg, &pos) == 1 && pos > 0) {
++	    p->autostep = iarg;
++	} else {
++	    mp_msg(MSGT_VFILTER, MSGL_FATAL,
++		"fixpts: unknown suboption: %s\n", args);
++	    return 0;
++	}
++	args += pos;
++	if(*args == ':')
++	    args++;
++    }
++    return 1;
++}
++
++static int open(vf_instance_t *vf, char *args)
++{
++    struct vf_priv_s *p;
++    struct vf_priv_s ptmp = {
++	.current = 0,
++	.step = 0,
++	.autostart = 0,
++	.autostep = 0,
++	.have_step = 0,
++	.print = 0,
++    };
++
++    if(!parse_args(&ptmp, args == NULL ? "" : args))
++	return 0;
++
++    vf->put_image = put_image;
++    vf->uninit = uninit;
++    vf->priv = p = malloc(sizeof(struct vf_priv_s));
++    *p = ptmp;
++    p->current = -p->step;
++
++    return 1;
++}
++
++vf_info_t vf_info_fixpts = {
++  "Fix presentation timestamps",
++  "fixpts",
++  "Nicolas George",
++  "",
++  &open,
++  NULL
++};
+diff -urNad svn~/mencoder.c svn/mencoder.c
+--- svn~/mencoder.c	2008-11-01 11:26:10.000000000 +0100
++++ svn/mencoder.c	2008-11-07 16:16:44.000000000 +0100
+@@ -198,6 +198,7 @@
+ 
+ int auto_expand=1;
+ int encode_duplicates=1;
++int keep_pts=0;
+ 
+ // infos are empty by default
+ char *info_name=NULL;
+@@ -361,6 +362,44 @@
+ 
+ static muxer_t* muxer=NULL;
+ 
++void add_subtitles(char *filename, float fps, int silent)
++{
++    sub_data *subd;
++#ifdef CONFIG_ASS
++    ass_track_t *asst = 0;
++#endif
++
++    if (filename == NULL) return;
++
++    subd = sub_read_file(filename, fps);
++#ifdef CONFIG_ASS
++    if (ass_enabled)
++#ifdef CONFIG_ICONV
++        asst = ass_read_file(ass_library, filename, sub_cp);
++#else
++        asst = ass_read_file(ass_library, filename, 0);
++#endif
++    if (ass_enabled && subd && !asst)
++        asst = ass_read_subdata(ass_library, subd, fps);
++
++    if (!asst && !subd && !silent)
++#else
++    if(!subd && !silent) 
++#endif
++        mp_msg(MSGT_CPLAYER, MSGL_ERR, MSGTR_CantLoadSub,
++		filename_recode(filename));
++ 
++#ifdef CONFIG_ASS
++    if (!asst && !subd) return;
++    ass_track = asst;
++#else
++    if (!subd) return;
++#endif
++    mp_msg(MSGT_IDENTIFY, MSGL_INFO, "ID_FILE_SUB_FILENAME=%s\n",
++	   filename_recode(filename));
++    subdata = subd;
++}
++
+ void print_wave_header(WAVEFORMATEX *h, int verbose_level);
+ 
+ int main(int argc,char* argv[]){
+@@ -562,6 +601,10 @@
+   m_entry_set_options(mconfig,&filelist[curfile]);
+   filename = filelist[curfile].name;
+  
++#ifdef CONFIG_ASS
++  ass_library = ass_init();
++#endif
++
+   if(!filename){
+ 	mp_msg(MSGT_CPLAYER, MSGL_FATAL, MSGTR_MissingFilename);
+ 	mencoder_exit(1,NULL);
+@@ -685,26 +728,6 @@
+     }
+   }
+ 
+-// after reading video params we should load subtitles because
+-// we know fps so now we can adjust subtitles time to ~6 seconds AST
+-// check .sub
+-//  current_module="read_subtitles_file";
+-  if(sub_name && sub_name[0]){
+-    subdata=sub_read_file(sub_name[0], sh_video->fps);
+-    if(!subdata) mp_msg(MSGT_CPLAYER,MSGL_ERR,MSGTR_CantLoadSub,sub_name[0]);
+-  } else
+-  if(sub_auto && filename) { // auto load sub file ...
+-    char **tmp = NULL;
+-    int i = 0;
+-    char *psub = get_path( "sub/" );
+-    tmp = sub_filenames((psub ? psub : ""), filename);
+-    free(psub);
+-    subdata=sub_read_file(tmp[0], sh_video->fps);
+-    while (tmp[i])
+-      free(tmp[i++]);
+-    free(tmp);
+-  }
+-
+ // set up video encoder:
+ 
+ if (!curfile) { // curfile is non zero when a second file is opened
+@@ -882,12 +905,83 @@
+     ve = sh_video->vfilter;
+   } else sh_video->vfilter = ve;
+     // append 'expand' filter, it fixes stride problems and renders osd:
++#ifdef CONFIG_ASS
++    if (auto_expand && !ass_enabled) { /* we do not want both */
++#else
+     if (auto_expand) {
++#endif
+       char* vf_args[] = { "osd", "1", NULL };
+       sh_video->vfilter=vf_open_filter(sh_video->vfilter,"expand",vf_args);
+     }
++
++#ifdef CONFIG_ASS
++  if(ass_enabled) {
++    int i;
++    int insert = 1;
++    if (vf_settings)
++      for (i = 0; vf_settings[i].name; ++i)
++        if (strcmp(vf_settings[i].name, "ass") == 0) {
++          insert = 0;
++          break;
++        }
++    if (insert) {
++      extern vf_info_t vf_info_ass;
++      vf_info_t* libass_vfs[] = {&vf_info_ass, NULL};
++      char* vf_arg[] = {"auto", "1", NULL};
++      vf_instance_t* vf_ass = vf_open_plugin(libass_vfs,sh_video->vfilter,"ass",vf_arg);
++      if (vf_ass)
++        sh_video->vfilter=(void*)vf_ass;
++      else
++        mp_msg(MSGT_CPLAYER,MSGL_ERR, "ASS: cannot add video filter\n");
++    }
++    if (!keep_pts) {
++      keep_pts = 1;
++      mp_msg(MSGT_MENCODER, MSGL_WARN, "Warning: -ass implies -keep-pts, "
++	"which may cause \"badly interleaved\" files.\n");
++    }
++
++    if (ass_library) {
++      for (i = 0; i < demuxer->num_attachments; ++i) {
++        demux_attachment_t* att = demuxer->attachments + i;
++        if (extract_embedded_fonts &&
++            att->name && att->type && att->data && att->data_size &&
++            (strcmp(att->type, "application/x-truetype-font") == 0 ||
++             strcmp(att->type, "application/x-font") == 0))
++          ass_add_font(ass_library, att->name, att->data, att->data_size);
++      }
++    }
++  }
++#endif
++
+     sh_video->vfilter=append_filters(sh_video->vfilter);
+ 
++#ifdef CONFIG_ASS
++  if (ass_enabled)
++    ((vf_instance_t *)sh_video->vfilter)->control(sh_video->vfilter, VFCTRL_INIT_EOSD, ass_library);
++#endif
++
++// after reading video params we should load subtitles because
++// we know fps so now we can adjust subtitles time to ~6 seconds AST
++// check .sub
++//  current_module="read_subtitles_file";
++  if(sub_name && sub_name[0]){
++    for (i = 0; sub_name[i] != NULL; ++i) 
++        add_subtitles (sub_name[i], sh_video->fps, 0); 
++  } else
++  if(sub_auto && filename) { // auto load sub file ...
++    char **tmp = NULL;
++    int i = 0;
++    char *psub = get_path( "sub/" );
++    tmp = sub_filenames((psub ? psub : ""), filename);
++    free(psub);
++    while (tmp[i])
++    {
++      add_subtitles (tmp[i], sh_video->fps, 0);
++      free(tmp[i++]);
++    }
++    free(tmp);
++  }
++
+     mp_msg(MSGT_CPLAYER,MSGL_INFO,"==========================================================================\n");
+     init_best_video_codec(sh_video,video_codec_list,video_fm_list);
+     mp_msg(MSGT_CPLAYER,MSGL_INFO,"==========================================================================\n");
+@@ -1343,7 +1437,8 @@
+     // decode_video will callback down to ve_*.c encoders, through the video filters
+     {void *decoded_frame = decode_video(sh_video,frame_data.start,frame_data.in_size,
+       skip_flag>0 && (!sh_video->vfilter || ((vf_instance_t *)sh_video->vfilter)->control(sh_video->vfilter, VFCTRL_SKIP_NEXT_FRAME, 0) != CONTROL_TRUE), MP_NOPTS_VALUE);
+-    blit_frame = decoded_frame && filter_video(sh_video, decoded_frame, MP_NOPTS_VALUE);}
++    blit_frame = decoded_frame && filter_video(sh_video, decoded_frame,
++	keep_pts ? sh_video->pts : MP_NOPTS_VALUE);}
+     
+     if (sh_video->vf_initialized < 0) mencoder_exit(1, NULL);
+     

Cambios de propiedades en debian-rvm/patches/05-ass_for_mencoder_embeddedfonts.dpatch
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/patches/10-gnome-screensave.dpatch
===================================================================
--- debian-rvm/patches/10-gnome-screensave.dpatch	(revisión: 0)
+++ debian-rvm/patches/10-gnome-screensave.dpatch	(revisión: 0)
@@ -0,0 +1,65 @@
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 05-version.dpatch by  <rvm@escomposlinux.org>
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: No description.
+
+@DPATCH@
+diff -ru mplayer-svn/libvo/x11_common.c mplayer.new/libvo/x11_common.c
+--- mplayer-svn/libvo/x11_common.c	2008-01-15 12:46:47.000000000 +0000
++++ mplayer-svn.new/libvo/x11_common.c	2008-01-15 12:37:26.000000000 +0000
+@@ -74,6 +74,7 @@
+ int stop_xscreensaver = 0;
+ 
+ static int dpms_disabled = 0;
++static int gnome_screensaver_was_running = 0;
+ 
+ char *mDisplayName = NULL;
+ Display *mDisplay = NULL;
+@@ -1632,6 +1633,12 @@
+     if (!screensaver_off)
+         return;
+     screensaver_off = 0;
++    if (gnome_screensaver_was_running && stop_xscreensaver)
++    {
++        system
++            ("gconftool-2 --type bool --set /apps/gnome-screensaver/idle_activation_enabled true 2>/dev/null >/dev/null");
++        gnome_screensaver_was_running = 0;
++    }
+     if (xss_suspend(False))
+         return;
+ #ifdef HAVE_XDPMS
+@@ -1664,6 +1671,7 @@
+         dpms_disabled = 0;
+     }
+ #endif
++
+ }
+ 
+ void saver_off(Display * mDisplay)
+@@ -1673,6 +1681,16 @@
+     if (screensaver_off)
+         return;
+     screensaver_off = 1;
++    if (stop_xscreensaver && !gnome_screensaver_was_running)
++    {
++        gnome_screensaver_was_running =
++            (system
++            ("gconftool-2 --get /apps/gnome-screensaver/idle_activation_enabled | grep true 2>/dev/null >/dev/null")
++            == 0);
++        if (gnome_screensaver_was_running)
++            system
++                ("gconftool-2 --type bool --set /apps/gnome-screensaver/idle_activation_enabled false 2>/dev/null >/dev/null");
++    }
+     if (xss_suspend(True))
+         return;
+ #ifdef HAVE_XDPMS
+@@ -1693,6 +1711,7 @@
+         }
+     }
+ #endif
++
+ }
+ 
+ static XErrorHandler old_handler = NULL;
+

Cambios de propiedades en debian-rvm/patches/10-gnome-screensave.dpatch
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/patches/12-codecs.dpatch
===================================================================
--- debian-rvm/patches/12-codecs.dpatch	(revisión: 0)
+++ debian-rvm/patches/12-codecs.dpatch	(revisión: 0)
@@ -0,0 +1,31 @@
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 12-codecs.dpatch by  <rvm@escomposlinux.org>
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: No description.
+
+@DPATCH@
+diff -urNad svn~/etc/codecs.conf svn/etc/codecs.conf
+--- svn~/etc/codecs.conf	2009-03-02 10:28:24.000000000 +0100
++++ svn/etc/codecs.conf	2009-03-02 10:39:22.000000000 +0100
+@@ -857,6 +857,20 @@
+   dll h264_vdpau
+   out VDPAU_H264
+ 
++videocodec coreserve
++  info "CoreAVC DShow H264 decoder for x86 - http://corecodec.org/"
++  status working
++  format 0x10000005
++  fourcc H264,h264 H264
++  fourcc X264,x264
++  fourcc avc1,AVC1 AVC1
++  fourcc davc,DAVC
++  fourcc VSSH
++  driver dshowserver
++  dll "CoreAVCDecoder.ax"
++  guid 0x09571a4b, 0xf1fe, 0x4c60, 0x97, 0x60, 0xde, 0x6d, 0x31, 0x0c, 0x7c, 0x31
++  out YV12,IYUV,I420,YUY2
++
+ videocodec ffsvq3
+   info "FFmpeg Sorenson Video v3 (SVQ3)"
+   status working

Cambios de propiedades en debian-rvm/patches/12-codecs.dpatch
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/patches/03-runtime_eq.dpatch
===================================================================
--- debian-rvm/patches/03-runtime_eq.dpatch	(revisión: 0)
+++ debian-rvm/patches/03-runtime_eq.dpatch	(revisión: 0)
@@ -0,0 +1,96 @@
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 03-runtime_eq.dpatch by  <rvm@escomposlinux.org>
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: No description.
+
+@DPATCH@
+diff -urNad svn~/DOCS/tech/slave.txt svn/DOCS/tech/slave.txt
+--- svn~/DOCS/tech/slave.txt	2008-10-19 09:16:55.000000000 +0200
++++ svn/DOCS/tech/slave.txt	2008-10-19 09:40:52.000000000 +0200
+@@ -461,6 +461,11 @@
+     Run <value> as shell command. In OSD menu console mode stdout and stdin
+     are through the video output driver.
+ 
++af_eq_set_bands <values>
++    Set bands gain in audio equalizer. Se details in manual (-af equalizer).
++    Example:
++       af_eq_set_bands 11:11:10:5:0:-12:0:5:12:12
++
+ 
+ Available properties:
+ 
+diff -urNad svn~/command.c svn/command.c
+--- svn~/command.c	2008-10-19 09:16:55.000000000 +0200
++++ svn/command.c	2008-10-19 09:40:52.000000000 +0200
+@@ -2966,6 +2966,13 @@
+ 	    }
+ 	    break;
+ 
++	case MP_CMD_AF_EQ_SET:{  
++      af_instance_t* m1=af_get(sh_audio->afilter, "equalizer");
++      if (m1) m1->control( m1, AF_CONTROL_COMMAND_LINE, cmd->args[0].v.s);
++      else mp_msg(MSGT_CPLAYER, MSGL_INFO, "failed (forgot -af equalizer=0:0 ?)\n");
++	    }
++      break;
++
+ 	case MP_CMD_VF_CHANGE_RECTANGLE:
+ 	    set_rectangle(sh_video, cmd->args[0].v.i, cmd->args[1].v.i);
+ 	    break;
+diff -urNad svn~/input/input.c svn/input/input.c
+--- svn~/input/input.c	2008-10-19 09:16:55.000000000 +0200
++++ svn/input/input.c	2008-10-19 09:40:52.000000000 +0200
+@@ -154,6 +154,7 @@
+   { MP_CMD_LOADLIST, "loadlist", 1, { {MP_CMD_ARG_STRING, {0}}, {MP_CMD_ARG_INT,{0}}, {-1,{0}} } },
+   { MP_CMD_RUN, "run", 1, { {MP_CMD_ARG_STRING,{0}}, {-1,{0}} } },
+   { MP_CMD_VF_CHANGE_RECTANGLE, "change_rectangle", 2, { {MP_CMD_ARG_INT,{0}}, {MP_CMD_ARG_INT,{0}}, {-1,{0}}}},
++  { MP_CMD_AF_EQ_SET, "af_eq_set_bands", 1, { {MP_CMD_ARG_STRING, {0}}, {-1,{0}}}}, //turbos
+ #ifdef CONFIG_TV_TELETEXT
+   { MP_CMD_TV_TELETEXT_ADD_DEC, "teletext_add_dec", 1, { {MP_CMD_ARG_STRING,{0}}, {-1,{0}} } },
+   { MP_CMD_TV_TELETEXT_GO_LINK, "teletext_go_link", 1, { {MP_CMD_ARG_INT,{0}}, {-1,{0}} } },
+diff -urNad svn~/input/input.h svn/input/input.h
+--- svn~/input/input.h	2008-10-19 09:16:55.000000000 +0200
++++ svn/input/input.h	2008-10-19 09:40:52.000000000 +0200
+@@ -111,6 +111,7 @@
+   MP_CMD_ASS_USE_MARGINS,
+   MP_CMD_SWITCH_TITLE,
+   MP_CMD_STOP,
++  MP_CMD_AF_EQ_SET,
+ 
+   /// DVDNAV commands
+   MP_CMD_DVDNAV_UP = 1000,
+diff -urNad svn~/libaf/af_equalizer.c svn/libaf/af_equalizer.c
+--- svn~/libaf/af_equalizer.c	2008-10-19 09:16:55.000000000 +0200
++++ svn/libaf/af_equalizer.c	2008-10-19 09:40:52.000000000 +0200
+@@ -125,12 +125,12 @@
+     }else{
+         s->gain_factor=1;
+     }
+-	
+     return af_test_output(af,arg);
+   }
+   case AF_CONTROL_COMMAND_LINE:{
+     float g[10]={0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0,0.0};
+     int i,j;
++    float gain_factor2=0.0;
+     sscanf((char*)arg,"%f:%f:%f:%f:%f:%f:%f:%f:%f:%f", &g[0], &g[1], 
+ 	   &g[2], &g[3], &g[4], &g[5], &g[6], &g[7], &g[8] ,&g[9]);
+     for(i=0;i<AF_NCH;i++){
+@@ -139,6 +139,17 @@
+ 	  pow(10.0,clamp(g[j],G_MIN,G_MAX)/20.0)-1.0;
+       }
+     }
++    
++    //calculate gainfactor for slave command
++    //see: af_eq_set_bands  -> input.c
++    //see code: AF_CONTROL_REINIT  in this file
++     for(j=0;j<KM;j++)
++        if(gain_factor2< s->g[0][j]) gain_factor2=s->g[0][j];
++     gain_factor2=log10(gain_factor2 + 1.0) * 20.0;
++     if(gain_factor2 > 0.0)   gain_factor2=0.1+(gain_factor2/12.0);
++     else gain_factor2=1;
++     s->gain_factor=gain_factor2;
++    
+     return AF_OK;
+   }
+   case AF_CONTROL_EQUALIZER_GAIN | AF_CONTROL_SET:{

Cambios de propiedades en debian-rvm/patches/03-runtime_eq.dpatch
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/patches/04-ass_for_mencoder.dpatch
===================================================================
--- debian-rvm/patches/04-ass_for_mencoder.dpatch	(revisión: 0)
+++ debian-rvm/patches/04-ass_for_mencoder.dpatch	(revisión: 0)
@@ -0,0 +1,489 @@
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 04-ass_for_mencoder.dpatch by  <rvm@escomposlinux.org>
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: No description.
+
+@DPATCH@
+diff -urNad svn~/DOCS/man/en/mplayer.1 svn/DOCS/man/en/mplayer.1
+--- svn~/DOCS/man/en/mplayer.1	2008-10-19 09:17:10.000000000 +0200
++++ svn/DOCS/man/en/mplayer.1	2008-10-19 09:42:21.000000000 +0200
+@@ -7171,6 +7171,48 @@
+ Threshold below which a pixel value is considered black (default: 32).
+ .RE
+ .
++.TP
++.B fixpts[=options]
++Fixes the presentation timestamps (PTS) of the frames.
++By default, the PTS passed to the next filter is dropped, but the following
++options can change that:
++.RSs
++.IPs print
++Print the incoming PTS.
++.IPs fps=<fps>
++Specify a frame per second value.
++.IPs start=<pts>
++Specify an initial value for the PTS.
++.IPs autostart=<n>
++Uses the 
++.IR n th
++incoming PTS as the initial PTS.
++All previous pts are kept, so setting a huge value or \-1 keeps the PTS
++intact.
++.IPs autofps=<n>
++Uses the 
++.IR n th
++incoming PTS after the end of autostart to determine the framerate.
++.RE
++.sp 1
++.RS
++.I EXAMPLE:
++.RE
++.PD 0
++.RSs
++.IPs "\-vf fixpts=fps=24000/1001,ass,fixpts"
++Generates a new sequence of PTS, uses it for ASS subtitles, then drops it.
++Generating a new sequence is useful when the timestamps are reset during the
++program; this is frequent on DVDs.
++Dropping it may be necessary to avoid confusing encoders.
++.RE
++.PD 1
++.sp 1
++.RS
++.I NOTE:
++Using this filter together with any sort of seeking (including -ss and EDLs)
++may make demons fly out of your nose.
++.RE
+ .
+ .
+ .SH "GENERAL ENCODING OPTIONS (MENCODER ONLY)"
+@@ -7293,6 +7335,14 @@
+ Do not write OpenDML index for AVI files >1GB.
+ .
+ .TP
++.B \-keep\-pts
++Send the original presentation timestamp (PTS) down the filter and encoder
++chain.
++This may cause incorrect output ("badly interleaved") if the original PTS
++are wrong or the framerate is changed, but can be necessary for certain
++filters (such as ASS).
++.
++.TP
+ .B \-noskip
+ Do not skip frames.
+ .
+diff -urNad svn~/Makefile svn/Makefile
+--- svn~/Makefile	2008-10-19 09:17:10.000000000 +0200
++++ svn/Makefile	2008-10-19 09:42:21.000000000 +0200
+@@ -125,6 +125,7 @@
+               libmpcodecs/vf_field.c \
+               libmpcodecs/vf_fil.c \
+               libmpcodecs/vf_filmdint.c \
++              libmpcodecs/vf_fixpts.c \
+               libmpcodecs/vf_flip.c \
+               libmpcodecs/vf_format.c \
+               libmpcodecs/vf_framestep.c \
+diff -urNad svn~/cfg-mencoder.h svn/cfg-mencoder.h
+--- svn~/cfg-mencoder.h	2008-10-19 09:17:10.000000000 +0200
++++ svn/cfg-mencoder.h	2008-10-19 09:42:21.000000000 +0200
+@@ -213,6 +213,9 @@
+ 	
+ 	{"odml", &write_odml, CONF_TYPE_FLAG, CONF_GLOBAL, 0, 1, NULL},
+ 	{"noodml", &write_odml, CONF_TYPE_FLAG, CONF_GLOBAL, 1, 0, NULL},
++
++	{"keep-pts", &keep_pts, CONF_TYPE_FLAG, 0, 0, 1, NULL},
++	{"nokeep-pts", &keep_pts, CONF_TYPE_FLAG, 0, 1, 0, NULL},
+ 	
+ 	// info header strings
+ 	{"info", info_conf, CONF_TYPE_SUBCONFIG, CONF_GLOBAL, 0, 0, NULL},
+diff -urNad svn~/libass/ass_cache.c svn/libass/ass_cache.c
+--- svn~/libass/ass_cache.c	2008-10-19 09:17:10.000000000 +0200
++++ svn/libass/ass_cache.c	2008-10-19 09:42:21.000000000 +0200
+@@ -291,6 +291,39 @@
+ 	free(value);
+ }
+ 
++static int glyph_compare(void* key1, void* key2, size_t key_size) {
++	glyph_hash_key_t* a = key1;
++	glyph_hash_key_t* b = key2;
++	return
++		a->font == b->font &&
++		a->size == b->size &&
++		a->ch == b->ch &&
++		a->bold == b->bold &&
++		a->italic == b->italic &&
++		a->scale_x == b->scale_x &&
++		a->scale_y == b->scale_y &&
++		a->advance.x == b->advance.x &&
++		a->advance.y == b->advance.y &&
++		a->outline == b->outline;
++}
++
++static unsigned glyph_hash(void* buf, size_t len)
++{
++	glyph_hash_key_t* g = buf;
++	unsigned hval = FNV1_32A_INIT;
++	hval = fnv_32a_buf(&g->font, sizeof(g->font), hval);
++	hval = fnv_32a_buf(&g->size, sizeof(g->size), hval);
++	hval = fnv_32a_buf(&g->ch, sizeof(g->ch), hval);
++	hval = fnv_32a_buf(&g->bold, sizeof(g->bold), hval);
++	hval = fnv_32a_buf(&g->italic, sizeof(g->italic), hval);
++	hval = fnv_32a_buf(&g->scale_x, sizeof(g->scale_x), hval);
++	hval = fnv_32a_buf(&g->scale_y, sizeof(g->scale_y), hval);
++	hval = fnv_32a_buf(&g->advance.x, sizeof(g->advance.x), hval);
++	hval = fnv_32a_buf(&g->advance.y, sizeof(g->advance.y), hval);
++	hval = fnv_32a_buf(&g->outline, sizeof(g->outline), hval);
++	return hval;
++}
++
+ void* cache_add_glyph(glyph_hash_key_t* key, glyph_hash_val_t* val)
+ {
+ 	return hashmap_insert(glyph_cache, key, val);
+@@ -311,7 +344,9 @@
+ 	glyph_cache = hashmap_init(sizeof(glyph_hash_key_t),
+ 				   sizeof(glyph_hash_val_t),
+ 				   0xFFFF + 13,
+-				   glyph_hash_dtor, NULL, NULL);
++				   glyph_hash_dtor,
++				   glyph_compare,
++				   glyph_hash);
+ }
+ 
+ void ass_glyph_cache_done(void)
+diff -urNad svn~/libmpcodecs/vf.c svn/libmpcodecs/vf.c
+--- svn~/libmpcodecs/vf.c	2008-10-19 09:17:10.000000000 +0200
++++ svn/libmpcodecs/vf.c	2008-10-19 09:42:21.000000000 +0200
+@@ -99,6 +99,7 @@
+ extern const vf_info_t vf_info_blackframe;
+ extern const vf_info_t vf_info_geq;
+ extern const vf_info_t vf_info_ow;
++extern const vf_info_t vf_info_fixpts;
+ 
+ // list of available filters:
+ static const vf_info_t* const filter_list[]={
+@@ -191,6 +192,7 @@
+     &vf_info_yadif,
+     &vf_info_blackframe,
+     &vf_info_ow,
++    &vf_info_fixpts,
+     NULL
+ };
+ 
+diff -urNad svn~/libmpcodecs/vf_fixpts.c svn/libmpcodecs/vf_fixpts.c
+--- svn~/libmpcodecs/vf_fixpts.c	1970-01-01 01:00:00.000000000 +0100
++++ svn/libmpcodecs/vf_fixpts.c	2008-10-19 09:42:21.000000000 +0200
+@@ -0,0 +1,137 @@
++/*
++    Copyright (C) 2007 Nicolas George <nicolas.george@normalesup.org>
++
++    This program is free software; you can redistribute it and/or modify
++    it under the terms of the GNU General Public License as published by
++    the Free Software Foundation; either version 2 of the License, or
++    (at your option) any later version.
++
++    This program is distributed in the hope that it will be useful,
++    but WITHOUT ANY WARRANTY; without even the implied warranty of
++    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
++    GNU General Public License for more details.
++
++    You should have received a copy of the GNU General Public License
++    along with this program; if not, write to the Free Software
++    Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301 USA
++*/
++
++#include <stdio.h>
++#include <stdlib.h>
++#include <string.h>
++#include <inttypes.h>
++
++#include "config.h"
++#include "mp_msg.h"
++#include "help_mp.h"
++
++#include "img_format.h"
++#include "mp_image.h"
++#include "vf.h"
++
++struct vf_priv_s {
++    double current;
++    double step;
++    int autostart;
++    int autostep;
++    unsigned have_step: 1;
++    unsigned print: 1;
++};
++
++static int put_image(vf_instance_t *vf, mp_image_t *src, double pts)
++{
++    struct vf_priv_s *p = vf->priv;
++
++    if(p->print) {
++	if(pts == MP_NOPTS_VALUE)
++	    printf("PTS: undef\n");
++	else
++	    printf("PTS: %f\n", pts);
++    }
++    if(pts != MP_NOPTS_VALUE && p->autostart != 0) {
++	p->current = pts;
++	if(p->autostart > 0)
++	    p->autostart--;
++    } else if(pts != MP_NOPTS_VALUE && p->autostep > 0) {
++	p->step = pts - p->current;
++	p->current = pts;
++	p->autostep--;
++	p->have_step = 1;
++    } else if(p->have_step) {
++	p->current += p->step;
++	pts = p->current;
++    } else {
++	pts = MP_NOPTS_VALUE;
++    }
++    return vf_next_put_image(vf, src, pts);
++}
++
++static void uninit(vf_instance_t *vf)
++{
++    free(vf->priv);
++}
++
++static int parse_args(struct vf_priv_s *p, const char *args)
++{
++    int pos;
++    double num, denom = 1;
++    int iarg;
++
++    while(*args != 0) {
++	pos = 0;
++	if(sscanf(args, "print%n", &pos) == 0 && pos > 0) {
++	    p->print = 1;
++	} else if(sscanf(args, "fps=%lf%n/%lf%n", &num, &pos, &denom, &pos) >= 1
++	    && pos > 0) {
++	    p->step = denom / num;
++	    p->have_step = 1;
++	} else if(sscanf(args, "start=%lf%n", &num, &pos) >= 1 && pos > 0) {
++	    p->current = num;
++	} else if(sscanf(args, "autostart=%d%n", &iarg, &pos) == 1 && pos > 0) {
++	    p->autostart = iarg;
++	} else if(sscanf(args, "autofps=%d%n", &iarg, &pos) == 1 && pos > 0) {
++	    p->autostep = iarg;
++	} else {
++	    mp_msg(MSGT_VFILTER, MSGL_FATAL,
++		"fixpts: unknown suboption: %s\n", args);
++	    return 0;
++	}
++	args += pos;
++	if(*args == ':')
++	    args++;
++    }
++    return 1;
++}
++
++static int open(vf_instance_t *vf, char *args)
++{
++    struct vf_priv_s *p;
++    struct vf_priv_s ptmp = {
++	.current = 0,
++	.step = 0,
++	.autostart = 0,
++	.autostep = 0,
++	.have_step = 0,
++	.print = 0,
++    };
++
++    if(!parse_args(&ptmp, args == NULL ? "" : args))
++	return 0;
++
++    vf->put_image = put_image;
++    vf->uninit = uninit;
++    vf->priv = p = malloc(sizeof(struct vf_priv_s));
++    *p = ptmp;
++    p->current = -p->step;
++
++    return 1;
++}
++
++vf_info_t vf_info_fixpts = {
++  "Fix presentation timestamps",
++  "fixpts",
++  "Nicolas George",
++  "",
++  &open,
++  NULL
++};
+diff -urNad svn~/mencoder.c svn/mencoder.c
+--- svn~/mencoder.c	2008-10-19 09:17:10.000000000 +0200
++++ svn/mencoder.c	2008-10-19 09:42:21.000000000 +0200
+@@ -198,6 +198,7 @@
+ 
+ int auto_expand=1;
+ int encode_duplicates=1;
++int keep_pts=0;
+ 
+ // infos are empty by default
+ char *info_name=NULL;
+@@ -361,6 +362,44 @@
+ 
+ static muxer_t* muxer=NULL;
+ 
++void add_subtitles(char *filename, float fps, int silent)
++{
++    sub_data *subd;
++#ifdef CONFIG_ASS
++    ass_track_t *asst = 0;
++#endif
++
++    if (filename == NULL) return;
++
++    subd = sub_read_file(filename, fps);
++#ifdef CONFIG_ASS
++    if (ass_enabled)
++#ifdef USE_ICONV
++        asst = ass_read_file(ass_library, filename, sub_cp);
++#else
++        asst = ass_read_file(ass_library, filename, 0);
++#endif
++    if (ass_enabled && subd && !asst)
++        asst = ass_read_subdata(ass_library, subd, fps);
++
++    if (!asst && !subd && !silent)
++#else
++    if(!subd && !silent) 
++#endif
++        mp_msg(MSGT_CPLAYER, MSGL_ERR, MSGTR_CantLoadSub,
++		filename_recode(filename));
++ 
++#ifdef CONFIG_ASS
++    if (!asst && !subd) return;
++    ass_track = asst;
++#else
++    if (!subd) return;
++#endif
++    mp_msg(MSGT_IDENTIFY, MSGL_INFO, "ID_FILE_SUB_FILENAME=%s\n",
++	   filename_recode(filename));
++    subdata = subd;
++}
++
+ extern void print_wave_header(WAVEFORMATEX *h, int verbose_level);
+ 
+ int main(int argc,char* argv[]){
+@@ -562,6 +601,10 @@
+   m_entry_set_options(mconfig,&filelist[curfile]);
+   filename = filelist[curfile].name;
+  
++#ifdef CONFIG_ASS
++  ass_library = ass_init();
++#endif
++
+   if(!filename){
+ 	mp_msg(MSGT_CPLAYER, MSGL_FATAL, MSGTR_MissingFilename);
+ 	mencoder_exit(1,NULL);
+@@ -685,26 +728,6 @@
+     }
+   }
+ 
+-// after reading video params we should load subtitles because
+-// we know fps so now we can adjust subtitles time to ~6 seconds AST
+-// check .sub
+-//  current_module="read_subtitles_file";
+-  if(sub_name && sub_name[0]){
+-    subdata=sub_read_file(sub_name[0], sh_video->fps);
+-    if(!subdata) mp_msg(MSGT_CPLAYER,MSGL_ERR,MSGTR_CantLoadSub,sub_name[0]);
+-  } else
+-  if(sub_auto && filename) { // auto load sub file ...
+-    char **tmp = NULL;
+-    int i = 0;
+-    char *psub = get_path( "sub/" );
+-    tmp = sub_filenames((psub ? psub : ""), filename);
+-    free(psub);
+-    subdata=sub_read_file(tmp[0], sh_video->fps);
+-    while (tmp[i])
+-      free(tmp[i++]);
+-    free(tmp);
+-  }
+-
+ // set up video encoder:
+ 
+ if (!curfile) { // curfile is non zero when a second file is opened
+@@ -885,12 +908,72 @@
+     ve = sh_video->vfilter;
+   } else sh_video->vfilter = ve;
+     // append 'expand' filter, it fixes stride problems and renders osd:
++#ifdef CONFIG_ASS
++    if (auto_expand && !ass_enabled) { /* we do not want both */
++#else
+     if (auto_expand) {
++#endif
+       char* vf_args[] = { "osd", "1", NULL };
+       sh_video->vfilter=vf_open_filter(sh_video->vfilter,"expand",vf_args);
+     }
++
++#ifdef CONFIG_ASS
++  if(ass_enabled) {
++    int i;
++    int insert = 1;
++    if (vf_settings)
++      for (i = 0; vf_settings[i].name; ++i)
++        if (strcmp(vf_settings[i].name, "ass") == 0) {
++          insert = 0;
++          break;
++        }
++    if (insert) {
++      extern vf_info_t vf_info_ass;
++      vf_info_t* libass_vfs[] = {&vf_info_ass, NULL};
++      char* vf_arg[] = {"auto", "1", NULL};
++      vf_instance_t* vf_ass = vf_open_plugin(libass_vfs,sh_video->vfilter,"ass",vf_arg);
++      if (vf_ass)
++        sh_video->vfilter=(void*)vf_ass;
++      else
++        mp_msg(MSGT_CPLAYER,MSGL_ERR, "ASS: cannot add video filter\n");
++    }
++    if (!keep_pts) {
++      keep_pts = 1;
++      mp_msg(MSGT_MENCODER, MSGL_WARN, "Warning: -ass implies -keep-pts, "
++	"which may cause \"badly interleaved\" files.\n");
++    }
++  }
++#endif
++
+     sh_video->vfilter=append_filters(sh_video->vfilter);
+ 
++#ifdef CONFIG_ASS
++  if (ass_enabled)
++    ((vf_instance_t *)sh_video->vfilter)->control(sh_video->vfilter, VFCTRL_INIT_EOSD, ass_library);
++#endif
++
++// after reading video params we should load subtitles because
++// we know fps so now we can adjust subtitles time to ~6 seconds AST
++// check .sub
++//  current_module="read_subtitles_file";
++  if(sub_name && sub_name[0]){
++    for (i = 0; sub_name[i] != NULL; ++i) 
++        add_subtitles (sub_name[i], sh_video->fps, 0); 
++  } else
++  if(sub_auto && filename) { // auto load sub file ...
++    char **tmp = NULL;
++    int i = 0;
++    char *psub = get_path( "sub/" );
++    tmp = sub_filenames((psub ? psub : ""), filename);
++    free(psub);
++    while (tmp[i])
++    {
++      add_subtitles (tmp[i], sh_video->fps, 0);
++      free(tmp[i++]);
++    }
++    free(tmp);
++  }
++
+     mp_msg(MSGT_CPLAYER,MSGL_INFO,"==========================================================================\n");
+     init_best_video_codec(sh_video,video_codec_list,video_fm_list);
+     mp_msg(MSGT_CPLAYER,MSGL_INFO,"==========================================================================\n");
+@@ -1346,7 +1429,8 @@
+     // decode_video will callback down to ve_*.c encoders, through the video filters
+     {void *decoded_frame = decode_video(sh_video,frame_data.start,frame_data.in_size,
+       skip_flag>0 && (!sh_video->vfilter || ((vf_instance_t *)sh_video->vfilter)->control(sh_video->vfilter, VFCTRL_SKIP_NEXT_FRAME, 0) != CONTROL_TRUE), MP_NOPTS_VALUE);
+-    blit_frame = decoded_frame && filter_video(sh_video, decoded_frame, MP_NOPTS_VALUE);}
++    blit_frame = decoded_frame && filter_video(sh_video, decoded_frame,
++	keep_pts ? sh_video->pts : MP_NOPTS_VALUE);}
+     
+     if (sh_video->vf_initialized < 0) mencoder_exit(1, NULL);
+     

Cambios de propiedades en debian-rvm/patches/04-ass_for_mencoder.dpatch
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/patches/00list
===================================================================
--- debian-rvm/patches/00list	(revisión: 0)
+++ debian-rvm/patches/00list	(revisión: 0)
@@ -0,0 +1,5 @@
+03-runtime_eq.dpatch
+05-ass_for_mencoder_embeddedfonts.dpatch
+10-gnome-screensave.dpatch
+11-dshowserver.dpatch
+12-codecs.dpatch
Index: debian-rvm/patches/11-dshowserver.dpatch
===================================================================
--- debian-rvm/patches/11-dshowserver.dpatch	(revisión: 0)
+++ debian-rvm/patches/11-dshowserver.dpatch	(revisión: 0)
@@ -0,0 +1,324 @@
+#! /bin/sh /usr/share/dpatch/dpatch-run
+## 11-dshowserver.dpatch by  <rvm@escomposlinux.org>
+##
+## All lines beginning with `## DP:' are a description of the patch.
+## DP: No description.
+
+@DPATCH@
+diff -urNad mplayer-1.0~rc2svn28035~/Makefile mplayer-1.0~rc2svn28035/Makefile
+--- mplayer-1.0~rc2svn28035~/Makefile	2008-12-10 12:24:24.000000000 +0100
++++ mplayer-1.0~rc2svn28035/Makefile	2008-12-10 12:36:58.000000000 +0100
+@@ -20,6 +20,7 @@
+ # 51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
+ 
+ include config.mak
++EXTRALIBS += -lrt
+ 
+ 
+ ###### variable declarations #######
+@@ -223,6 +224,7 @@
+               stream/stream_mf.c \
+               stream/stream_null.c \
+               stream/url.c \
++              libmpcodecs/vd_dshowserver.c \
+ 
+ SRCS_COMMON-$(AUDIO_INPUT)-$(ALSA1X) += stream/ai_alsa1x.c
+ SRCS_COMMON-$(AUDIO_INPUT)-$(ALSA9)  += stream/ai_alsa.c
+diff -urNad mplayer-1.0~rc2svn28035~/libmpcodecs/vd.c mplayer-1.0~rc2svn28035/libmpcodecs/vd.c
+--- mplayer-1.0~rc2svn28035~/libmpcodecs/vd.c	2008-10-16 20:24:18.000000000 +0200
++++ mplayer-1.0~rc2svn28035/libmpcodecs/vd.c	2008-12-10 12:36:58.000000000 +0100
+@@ -29,6 +29,7 @@
+ extern vd_functions_t mpcodecs_vd_ffmpeg;
+ extern vd_functions_t mpcodecs_vd_theora;
+ extern vd_functions_t mpcodecs_vd_dshow;
++extern vd_functions_t mpcodecs_vd_dshowserver;
+ extern vd_functions_t mpcodecs_vd_dmo;
+ extern vd_functions_t mpcodecs_vd_vfw;
+ extern vd_functions_t mpcodecs_vd_vfwex;
+@@ -61,6 +62,7 @@
+ #ifdef CONFIG_OGGTHEORA
+ 	&mpcodecs_vd_theora,
+ #endif
++        &mpcodecs_vd_dshowserver,
+ #ifdef CONFIG_WIN32DLL
+         &mpcodecs_vd_dshow,
+         &mpcodecs_vd_dmo,
+diff -urNad mplayer-1.0~rc2svn28035~/libmpcodecs/vd_dshowserver.c mplayer-1.0~rc2svn28035/libmpcodecs/vd_dshowserver.c
+--- mplayer-1.0~rc2svn28035~/libmpcodecs/vd_dshowserver.c	1970-01-01 01:00:00.000000000 +0100
++++ mplayer-1.0~rc2svn28035/libmpcodecs/vd_dshowserver.c	2008-12-10 12:36:58.000000000 +0100
+@@ -0,0 +1,275 @@
++#include <stdio.h>
++#include <stdlib.h>
++#include <stdarg.h>
++#include <semaphore.h>
++#include <sys/mman.h>
++#include <pthread.h>
++
++#include <sys/types.h>
++#include <unistd.h>
++#include <sys/stat.h>
++#include <fcntl.h>
++#include <time.h>
++#include <sys/wait.h>
++
++#include "config.h"
++
++#include "mp_msg.h"
++#include "help_mp.h"
++
++#include "vd_internal.h"
++
++struct vd_struct {
++  union {
++    uint32_t ret;
++    uint32_t cmd;
++  };
++  uint32_t buflen;
++  uint64_t pts;
++  uint32_t unused[8];
++} __attribute__((__packed__));
++
++enum {
++  VD_END = 1,
++  VD_DECODE = 2,
++  VD_SEEK = 3,
++  VD_HAS_BIH = 0x10000,
++  VD_VERSION_MASK = 0xFFFF,
++};
++
++#ifdef __APPLE__
++  void ALRMhandler(int sig) {
++  }
++  int sem_twait(sem_t *sem, int t) {
++    int ret;
++    alarm(t);
++    ret = sem_wait(sem);
++    printf("twait complete\n");
++    return ret;
++  }
++  void init_twait() {
++    sigset_t none;
++    struct sigaction sa;
++    sigemptyset(&none);
++    sigprocmask(SIG_SETMASK, &none, 0);
++
++    sa.sa_handler = ALRMhandler;
++    sa.sa_flags = 0;
++    sigemptyset(&sa.sa_mask);
++    sigaction(SIGALRM, &sa, 0);
++  }
++#else
++  int sem_twait(sem_t *sem, int t) {
++    struct timespec ts;
++    clock_gettime(CLOCK_REALTIME, &ts);
++    ts.tv_sec += t;
++    return(sem_timedwait(sem, &ts));
++  }
++  void init_twait() {}
++#endif
++
++static vd_info_t info = {
++	"DirectShowServer video codecs",
++	"dshowserver",
++	"Alan Nisota",
++	"based on dshow",
++	"win32 codecs"
++};
++
++LIBVD_EXTERN(dshowserver)
++typedef struct {
++    int fd;
++    void *mem;
++    char *data;
++    char *picture;
++    int picsize;
++    int pagesize;
++    sem_t *sem_rd;
++    sem_t *sem_wr;
++    struct vd_struct *vd;
++} ds_mpi_t;
++static ds_mpi_t *ds_mpi;
++
++// to set/get/query special features/parameters
++static int control(sh_video_t *sh __attribute((unused)),int cmd,void* arg __attribute((unused)),...){
++    switch(cmd){
++    case VDCTRL_RESYNC_STREAM:
++      printf("Seek now\n");
++      ds_mpi->vd->cmd = VD_SEEK; //'3' is cmd for seek
++      sem_post(ds_mpi->sem_wr);
++      sem_twait(ds_mpi->sem_rd, 10);
++      return CONTROL_TRUE;
++    case VDCTRL_QUERY_MAX_PP_LEVEL:
++	return 4;
++    case VDCTRL_QUERY_UNSEEN_FRAMES:
++	return 10;
++
++    }
++    return CONTROL_UNKNOWN;
++}
++
++static int my_system(const char *command)
++{
++    pid_t child = fork();
++
++    if (child < 0)
++    {
++        /* Fork failed */
++        return child;
++    }
++    else if (child == 0)
++    {
++        /* Child */
++        int i;
++        /* Close all open file descriptors except stdout/stderr */
++        for (i = sysconf(_SC_OPEN_MAX) - 1; i > 2; i--)
++            close(i);
++
++        /* Attach stdin to /dev/null */
++        /*
++        close(0);
++        int fd = open("/dev/null", O_RDONLY);
++        dup2(fd, 0);
++        if (fd != 0)
++            close(fd);
++        */
++        /* Run command */
++        execl("/bin/sh", "sh", "-c", command, NULL);
++        _exit(0);
++    }
++    else
++    {
++        /* Parent */
++        int status;
++
++        waitpid(child, &status, 0);
++        return status;
++    }
++
++    return 1;
++}
++    
++// init driver
++static int init(sh_video_t *sh){
++    int ret;
++    char cmd[255], shm[80], sem1[80], sem2[80];
++    uint32_t out_fmt;
++    int bpp, w, h;
++    int extra = 0;
++    int numpages = 10;
++    int memsize;
++
++    init_twait();
++    out_fmt = sh->codec->outfmt[sh->outfmtidx];
++    switch(out_fmt){
++      case IMGFMT_YUY2:
++      case IMGFMT_UYVY:
++	bpp = 16; break;
++      case IMGFMT_YV12:
++      case IMGFMT_I420:
++      case IMGFMT_IYUV:
++	bpp = 12; break;
++      case IMGFMT_YVU9:
++        bpp = 9; break;
++      default:
++        bpp = 24; break;
++    }
++    w = sh->disp_w; h = sh->disp_h;
++    snprintf(cmd, 255, "dshowserver -c %s -s %dx%d "
++             "-g %08x-%04x-%04x-%02x%02x%02x%02x%02x%02x%02x%02x "
++             "-f 0x%08x -b %d -o 0x%08x -p %d -i %x -n %d %s&",
++             sh->codec->dll, w, h,
++             (unsigned int)sh->codec->guid.f1, sh->codec->guid.f2, sh->codec->guid.f3,
++             sh->codec->guid.f4[0], sh->codec->guid.f4[1], sh->codec->guid.f4[2], sh->codec->guid.f4[3],
++             sh->codec->guid.f4[4], sh->codec->guid.f4[5], sh->codec->guid.f4[6], sh->codec->guid.f4[7],
++             (unsigned int)sh->format, bpp, out_fmt, getpid(), *(int *)pthread_self(), numpages, "");
++    snprintf(shm, 80, "/dshow_shm.%x", *(int *)pthread_self());
++    snprintf(sem1, 80, "/dshow_sem1.%x", *(int *)pthread_self());
++    snprintf(sem2, 80, "/dshow_sem2.%x", *(int *)pthread_self());
++    ds_mpi = (ds_mpi_t *) malloc(sizeof(ds_mpi_t));
++    ds_mpi->fd = shm_open(shm, O_RDWR | O_CREAT, S_IRUSR | S_IWUSR);
++    ds_mpi->picsize =  w * h * bpp / 8;
++    ds_mpi->pagesize = ds_mpi->picsize + 1024;
++    memsize = sizeof(struct vd_struct) + w * h + ds_mpi->picsize + extra + ds_mpi->pagesize * numpages;
++    ftruncate(ds_mpi->fd, memsize);
++    ds_mpi->mem = mmap(NULL, memsize, PROT_READ | PROT_WRITE, MAP_SHARED, ds_mpi->fd, 0);
++    if(ds_mpi->mem == MAP_FAILED) {
++      perror("mmap");
++      return 0;
++    }
++    memset((char *)ds_mpi->mem, 0, sizeof(struct vd_struct));
++    if (extra)
++      memset((char *)ds_mpi->mem + (memsize - extra), 0, extra);
++    ds_mpi->vd = (struct vd_struct *)ds_mpi->mem;
++    ds_mpi->data = ((char *)ds_mpi->mem) + sizeof(struct vd_struct);
++    ds_mpi->picture = ds_mpi->data + w * h;
++    if(sh->bih->biWidth && sh->bih->biHeight) {
++      ds_mpi->vd->cmd |= VD_HAS_BIH; //Use embedded bih
++      memcpy(ds_mpi->data, sh->bih, sh->bih->biSize);
++    }
++    //Create read/write semaphores in locked state
++    ds_mpi->sem_wr = sem_open(sem1, O_CREAT, 0644, 0);
++    ds_mpi->sem_rd = sem_open(sem2, O_CREAT, 0644, 0);
++    my_system(cmd);
++    ret = sem_twait(ds_mpi->sem_rd, 10);
++    shm_unlink(shm);
++    sem_unlink(sem1);
++    sem_unlink(sem2);
++    if(ret != 0) {
++      printf("DirectShow filter failed");
++      return 0;
++    } else {
++      if(!mpcodecs_config_vo(sh,w,h,IMGFMT_YUY2)) return 0;
++      printf("Found DirectShow filter");
++      return 1;
++    }
++}
++
++// uninit driver
++static void uninit(sh_video_t *sh __attribute((unused))){
++    if(ds_mpi) {
++      printf("Destroying filter");
++      ds_mpi->vd->cmd = VD_END; //'1' is cmd for terminating
++      sem_post(ds_mpi->sem_wr);
++      close(ds_mpi->fd);
++      sem_close(ds_mpi->sem_wr);
++      sem_close(ds_mpi->sem_rd);
++      free(ds_mpi);
++      ds_mpi = NULL;
++    }
++}
++
++//mp_image_t* mpcodecs_get_image(sh_video_t *sh, int mp_imgtype, int mp_imgflag, int w, int h);
++
++// decode a frame
++static mp_image_t* decode(sh_video_t *sh,void* data,int len,int flags){
++   mp_image_t* mpi = NULL;
++   int ret;
++   if(len<=0) return NULL; // skipped frame
++    
++   if(flags&3) {
++      // framedrop:
++      return NULL;
++   }
++   ds_mpi->vd->cmd = VD_DECODE; //'2' is cmd for decoding
++   ds_mpi->vd->pts = (uint64_t)(sh->buffered_pts[0]*1E9);
++   memcpy(ds_mpi->data, data, len);
++   ds_mpi->vd->buflen = len;
++   sem_post(ds_mpi->sem_wr);
++   ret = sem_twait(ds_mpi->sem_rd, 10);
++   //printf("PTS (%d): %f -> %f\n", ds_mpi->vd->ret, sh->buffered_pts[0], (double)ds_mpi->vd->pts/1E9);
++   //printf("PTS (%d): %f(%d) -> %d\n", ds_mpi->vd->ret, sh->buffered_pts[0], pts-1, ds_mpi->vd->pts);
++   if(ret == 0 && ds_mpi->vd->ret && ! (ds_mpi->vd->ret & (1<<31))) {
++     if(ds_mpi->vd->pts)
++       sh->buffered_pts[0] = (double)ds_mpi->vd->pts/1E9;
++     mpi=mpcodecs_get_image(sh, MP_IMGTYPE_TEMP, 0 /*MP_IMGFLAG_ACCEPT_STRIDE*/, 
++                            sh->disp_w, sh->disp_h);
++     if(ds_mpi->vd->ret & 0x02) {
++       unsigned char page = ds_mpi->vd->ret >> 8;
++       memcpy(mpi->planes[0], ds_mpi->picture + ds_mpi->picsize + page * ds_mpi->pagesize, ds_mpi->picsize);
++     } else {
++       memcpy(mpi->planes[0], ds_mpi->picture, ds_mpi->picsize);
++     }
++   }
++   return mpi;
++}

Cambios de propiedades en debian-rvm/patches/11-dshowserver.dpatch
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/copyright
===================================================================
--- debian-rvm/copyright	(revisión: 0)
+++ debian-rvm/copyright	(revisión: 0)
@@ -0,0 +1,28 @@
+This package was debianized by Sebastian Dröge <slomo@ubuntu.com>
+Thu, 01 Dec 2005 20:40:19 +0100.
+
+It was downloaded from http://www.mplayerhq.hu
+
+Copyright Holders:
+ MPlayer is copyrighted by various authors.
+ They are all listed in the 'Copyright' file
+
+License:
+
+ mplayer is free software; you can redistribute it and/or
+ modify it under the terms of the GNU General Public License as
+ published by the Free Software Foundation; either version 2 of the
+ License, or (at your option) any later version.
+
+ mplayer is distributed in the hope that it will be useful,
+ but WITHOUT ANY WARRANTY; without even the implied warranty of
+ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ General Public License for more details.
+
+ You should have received a copy of the GNU General Public License
+ along with this program; if not, write to the Free Software
+ Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA.
+
+On Debian systems, the complete text of the GNU General
+Public License can be found in `/usr/share/common-licenses/GPL'.
+
Index: debian-rvm/rules
===================================================================
--- debian-rvm/rules	(revisión: 0)
+++ debian-rvm/rules	(revisión: 0)
@@ -0,0 +1,155 @@
+#!/usr/bin/make -f
+#-*- makefile -*-
+
+#export DH_VERBOSE=1
+
+include /usr/share/dpatch/dpatch.make
+
+unexport CFLAGS
+
+DEB_BUILD_ARCH ?= $(shell dpkg-architecture -qDEB_BUILD_ARCH)
+
+ifeq (,$(findstring nostrip,$(DEB_BUILD_OPTIONS)))
+	INSTALL_PROGRAM += -s
+endif
+
+ifeq "$(DEB_BUILD_ARCH)" "i386"
+	CONFIGURE_ARCH = --enable-runtime-cpudetection --target=i586-linux
+else
+ifeq "$(DEB_BUILD_ARCH)" "powerpc"
+	CONFIGURE_ARCH = --enable-runtime-cpudetection --enable-altivec
+else
+ifeq "$(DEB_BUILD_ARCH)" "amd64"
+	CONFIGURE_ARCH = --enable-runtime-cpudetection
+endif
+endif
+endif
+
+CONFIGURE_PATH := --prefix=/usr --confdir=/etc/mplayer --mandir=/usr/share/man --win32codecsdir=/usr/lib/win32
+#CONFIGURE_COMMON := --enable-largefiles
+CONFIGURE_INPUT :=  --disable-dvdread-internal 
+#CONFIGURE_CONTROL := --enable-lirc --enable-joystick --enable-xf86keysym 
+#CONFIGURE_AUDIO_CODECS := --disable-tremor-internal --enable-liba52 --enable-musepack --enable-speex --enable-libvorbis --enable-mad --enable-mp3lib
+#CONFIGURE_VIDEO_CODECS := --enable-theora --enable-libdv --enable-libmpeg2 --enable-tv-v4l2
+#CONFIGURE_AUDIO_OUT := --enable-alsa --enable-ossaudio --enable-esd --enable-arts --enable-pulse --enable-nas
+CONFIGURE_VIDEO_OUT := --enable-xvmc --enable-menu
+#CONFIGURE_MISC := --enable-freetype --enable-gif --enable-png --enable-jpeg --enable-liblzo --enable-fribidi --enable-ladspa
+
+CONFIGURE_ALL := $(CONFIGURE_ARCH) $(CONFIGURE_PATH) $(CONFIGURE_COMMON) $(CONFIGURE_INPUT) $(CONFIGURE_CONTROL) $(CONFIGURE_AUDIO_CODECS) $(CONFIGURE_VIDEO_CODECS) $(CONFIGURE_AUDIO_OUT) $(CONFIGURE_VIDEO_OUT) $(CONFIGURE_MISC)
+
+build-gui: build-gui-stamp
+build-gui-stamp: patch 
+	dh_testdir
+	./configure $(CONFIGURE_ALL) --enable-gui --enable-mencoder 
+	$(MAKE)
+
+# Documentation
+	cd DOCS/xml && ./configure && make html-chunked
+
+	touch build-gui-stamp
+
+#build-nogui: build-nogui-stamp
+#build-nogui-stamp:
+#	dh_testdir
+#	if test -f build-gui-stamp; then \
+#	  $(MAKE) distclean; \
+#	  rm -f build-gui-stamp; \
+#	fi
+#	./configure $(CONFIGURE_ALL) --disable-gui --disable-mencoder
+#	$(MAKE) -f debian/rules modify-config
+#	$(MAKE)
+#	touch build-nogui-stamp
+
+install:
+	dh_testdir
+	dh_testroot
+	dh_clean -k
+	$(MAKE) -f debian/rules install-gui
+#	$(MAKE) -f debian/rules install-nogui
+
+install-gui: build-gui
+	dh_installdirs -pmplayer
+	$(MAKE) install DESTDIR=$(CURDIR)/debian/mplayer
+	
+	dh_link -pmplayer usr/bin/mplayer usr/bin/gmplayer
+	dh_link -pmplayer usr/share/man/man1/mplayer.1.gz usr/share/man/man1/gmplayer.1.gz
+	dh_link -pmplayer usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf usr/share/mplayer/subfont.ttf
+#	cp etc/example.conf etc/mplayer.conf
+	cp debian/mplayer.conf debian/mplayer/etc/mplayer/
+#	dh_install -pmplayer etc/mplayer.conf etc/mplayer
+#	rm -f etc/mplayer.conf
+	dh_install -pmplayer etc/input.conf etc/mplayer
+	dh_install -pmplayer etc/menu.conf etc/mplayer
+	dh_installexamples -pmplayer -X.svn -X.libdeps etc
+	dh_install -pmplayer
+
+	#remove mencoder manpage link to prevent conflict with the mencoder package
+	rm debian/mplayer/usr/share/man/man1/mencoder.1
+
+	#split off mencoder package
+	mkdir -p debian/mencoder/usr/bin
+	mv debian/mplayer/usr/bin/mencoder debian/mencoder/usr/bin
+	mkdir -p debian/mencoder/usr/share/man/man1
+	cp debian/mplayer/usr/share/man/man1/mplayer.1 debian/mencoder/usr/share/man/man1/mencoder.1
+
+#install-nogui: build-nogui
+#	dh_installdirs -pmplayer-nogui
+#	$(MAKE) install DESTDIR=$(CURDIR)/debian/mplayer-nogui
+#	dh_link -pmplayer-nogui usr/share/fonts/truetype/ttf-dejavu/DejaVuSans.ttf usr/share/mplayer/subfont.ttf
+#	cp etc/example.conf etc/mplayer.conf
+#	dh_install -pmplayer-nogui etc/mplayer.conf etc/mplayer
+#	rm -f etc/mplayer.conf
+#	dh_install -pmplayer-nogui etc/input.conf etc/mplayer
+#	dh_install -pmplayer-nogui etc/menu.conf etc/mplayer
+#	dh_installexamples -pmplayer-nogui -X.libdeps etc
+#	dh_install -pmplayer-nogui
+
+clean: unpatch
+	dh_testdir
+	dh_testroot
+	-cd DOCS/xml && $(MAKE) distclean
+	-$(MAKE) distclean
+	-rm -f build-nogui-stamp build-gui-stamp
+	# additional cleanups
+	#-rm config.mak version.h libaf/config.mak libao2/config.mak libvo/config.mak Gui/config.mak
+	dh_clean
+
+binary-indep: build install
+	dh_testdir
+	dh_testroot
+	dh_installdocs -pmplayer-doc -X.svn Copyright DOCS/HTML DOCS/tech
+	dh_installchangelogs -i
+	dh_compress -i
+	dh_link -i
+	dh_fixperms -i
+	dh_strip -i
+	dh_installdeb -i
+	dh_gencontrol -i
+	dh_md5sums -i
+#	dh_builddeb -- -Z lzma
+	dh_builddeb -i
+
+binary-arch: build install
+	dh_testdir
+	dh_testroot
+	dh_install -a
+	dh_installdocs -a -A Copyright
+	dh_installmenu -a
+	dh_installmime -a
+	dh_installman -a
+	dh_installchangelogs -a Changelog
+	dh_desktop -a
+	dh_compress -a
+	dh_link -a
+	dh_fixperms -a
+	dh_strip -a
+	dh_perl -a
+	dh_installdeb -a
+	dh_shlibdeps -a
+	dh_gencontrol -a
+	dh_md5sums -a
+#	dh_builddeb -- -Z lzma
+	dh_builddeb -a
+
+binary: binary-indep binary-arch
+.PHONY: build clean binary-indep binary-arch binary

Cambios de propiedades en debian-rvm/rules
___________________________________________________________________
Nombre: svn:executable
   + *

Index: debian-rvm/mplayer-nogui.preinst
===================================================================
--- debian-rvm/mplayer-nogui.preinst	(revisión: 0)
+++ debian-rvm/mplayer-nogui.preinst	(revisión: 0)
@@ -0,0 +1,40 @@
+#!/bin/sh
+
+set -e
+
+# Remove a no-longer used conffile
+rm_conffile() {
+    CONFFILE="$1"
+
+    if [ -e "$CONFFILE" ]; then
+        md5sum="`md5sum \"$CONFFILE\" | sed -e \"s/ .*//\"`"
+	old_md5sum="`sed -n -e \"/^Conffiles:/,/^[^ ]/{\\\\' $CONFFILE '{s/ obsolete$//;s/.* //;p}}\" /var/lib/dpkg/status`"
+        if [ "$md5sum" != "$old_md5sum" ]; then
+            echo "Obsolete conffile $CONFFILE has been modified by you."
+            echo "Saving as $CONFFILE.dpkg-bak ..."
+            mv -f "$CONFFILE" "$CONFFILE".dpkg-bak
+        else
+            echo "Removing obsolete conffile $CONFFILE ..."
+            rm -f "$CONFFILE"
+        fi
+    fi
+}
+
+case "$1" in
+    install|upgrade)
+        if dpkg --compare-versions "$2" le "2:0.99+1.0pre8-0ubuntu5"; then
+            rm_conffile "/etc/mplayer/codecs.conf"
+        fi
+    ;;
+
+    abort-upgrade)
+    ;;
+
+    *)
+        echo "preinst called with unknown argument \`$1'" >&2
+        exit 1
+    ;;
+esac
+
+#DEBHELPER#
+
Index: debian-rvm/mplayer.preinst
===================================================================
--- debian-rvm/mplayer.preinst	(revisión: 0)
+++ debian-rvm/mplayer.preinst	(revisión: 0)
@@ -0,0 +1,40 @@
+#!/bin/sh
+
+set -e
+
+# Remove a no-longer used conffile
+rm_conffile() {
+    CONFFILE="$1"
+
+    if [ -e "$CONFFILE" ]; then
+        md5sum="`md5sum \"$CONFFILE\" | sed -e \"s/ .*//\"`"
+	old_md5sum="`sed -n -e \"/^Conffiles:/,/^[^ ]/{\\\\' $CONFFILE '{s/ obsolete$//;s/.* //;p}}\" /var/lib/dpkg/status`"
+        if [ "$md5sum" != "$old_md5sum" ]; then
+            echo "Obsolete conffile $CONFFILE has been modified by you."
+            echo "Saving as $CONFFILE.dpkg-bak ..."
+            mv -f "$CONFFILE" "$CONFFILE".dpkg-bak
+        else
+            echo "Removing obsolete conffile $CONFFILE ..."
+            rm -f "$CONFFILE"
+        fi
+    fi
+}
+
+case "$1" in
+    install|upgrade)
+        if dpkg --compare-versions "$2" le "2:0.99+1.0pre8-0ubuntu5"; then
+            rm_conffile "/etc/mplayer/codecs.conf"
+        fi
+    ;;
+
+    abort-upgrade)
+    ;;
+
+    *)
+        echo "preinst called with unknown argument \`$1'" >&2
+        exit 1
+    ;;
+esac
+
+#DEBHELPER#
+
Index: debian-rvm/README
===================================================================
--- debian-rvm/README	(revisión: 0)
+++ debian-rvm/README	(revisión: 0)
@@ -0,0 +1,16 @@
+Source managment of ubuntu package
+
+Short: go here:
+
+https://launchpad.net/products/mplayer/+branches
+
+In the past we used dpatch to handle the mplayer package.
+nowadays, we handle the ubuntu package in bzr. Have a look
+at https://launchpad.net/products/mplayer/+branches to see 
+the different branches, into which the former dpatches
+where included.
+
+Please be careful when you update to 'upstream' branch. 
+Use the 'get-orig-source' target to clean the upstream tarballs.
+
+use bzr export to generate new orig.tar.gz
Index: debian-rvm/mplayer.conf
===================================================================
--- debian-rvm/mplayer.conf	(revisión: 0)
+++ debian-rvm/mplayer.conf	(revisión: 0)
@@ -0,0 +1,138 @@
+#
+# MPlayer configuration file
+#
+# Configuration files are read system-wide from /usr/local/etc/mplayer.conf
+# and per user from ~/.mplayer/config, where per-user settings override
+# system-wide settings, all of which are overrriden by the command line.
+#
+# The configuration file settings are the same as the command line
+# options without the preceding '-'.
+#
+# See the CONFIGURATION FILES section in the man page
+# for a detailed description of the syntax.
+
+
+##################
+# video settings #
+##################
+
+# Specify default video driver (see -vo help for a list).
+vo=xv,
+
+# Use SDL video with the aalib subdriver by default.
+#vo = sdl:aalib
+
+# FBdev driver:
+#
+# mode to use (read from fb.modes)
+#fbmode = 640x480-120
+#
+# location of the fb.modes file
+#fbmodeconfig = /etc/fb.modes
+
+# Specify your monitor timings for the vesa and fbdev video output drivers.
+# See /etc/X11/XF86Config for timings. Be careful; if you specify settings
+# that exceed the capabilities of your monitor, you may damage it.
+#
+# horizontal frequency range (k stands for 1000)
+#monitor-hfreq = 31.5k-50k,70k
+#
+# vertical frequency range
+#monitor-vfreq = 50-90
+#
+# dotclock (or pixelclock) range (m stands for 1000000)
+#monitor-dotclock = 30M-300M
+
+# Start in fullscreen mode by default.
+#fs=yes
+
+# Change to a different videomode when going fullscreen.
+#vm=yes
+
+# Override the autodetected color depth, may need 'vm=yes' as well.
+#bpp=0
+
+# Enable software scaling (powerful CPU needed) for video output
+# drivers that do not support hardware scaling.
+#zoom=yes
+
+# standard monitor size, with square pixels
+#monitoraspect=4:3
+
+# Use this for a widescreen monitor, non-square pixels.
+#monitoraspect=16:9
+
+# Keep the player window on top of all other windows.
+#ontop=yes
+
+
+##################
+# audio settings #
+##################
+
+# Specify default audio driver (see -ao help for a list).
+ao=alsa,
+
+# Use SDL audio driver with the esd subdriver by default.
+#ao = sdl:esd
+
+# Specify the mixer device.
+#mixer = /dev/mixer
+
+# Resample the sound to 44100Hz with the lavcresample audio filter.
+#af=lavcresample=44100
+
+
+##################
+# other settings #
+##################
+
+# Default font
+#font=/usr/share/fonts/truetype/ttf-bitstream-vera/Vera.ttf
+
+# Font size
+#subfont-text-scale=3
+#subfont-osd-scale=3
+
+# Pretend to be Window Media Player.
+# Fixes playback when playlist and media file use the same URL.
+#user-agent=NSPlayer/4.1.0.3856
+
+# Drop frames to preserve audio/video sync.
+#framedrop = yes
+
+# Specify your preferred skin here (skins are searched for in
+# /usr/local/share/mplayer/skins/<name> and ~/.mplayer/skins/<name>).
+#skin = Abyss
+
+# Resample the font alphamap.
+# 0     plain white fonts
+# 0.75  very narrow black outline (default)
+# 1     narrow black outline
+# 10    bold black outline
+#ffactor = 0.75
+
+# cache settings
+#
+# Use 8MB input cache by default.
+#cache = 8192
+#
+# Prefill 20% of the cache before starting playback.
+#cache-min = 20.0
+#
+# Prefill 50% of the cache before restarting playback after the cache emptied.
+#cache-seek-min = 50
+
+# DVD: Display English subtitles if available.
+#slang = en
+
+# DVD: Play English audio tracks if available.
+#alang = en
+
+###################
+# DVDNAV Settings #
+###################
+#vc=ffmpeg12,
+
+# You can also include other configuration files.
+#include = /path/to/the/file/you/want/to/include
